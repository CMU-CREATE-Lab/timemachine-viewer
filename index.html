<html>
<head>
   <title>Gigapan Timelapse Explorer</title>
   <script src="js/jquery/jquery.min.js"></script>
   <script src="js/jquery/jquery-ui-1.8.6.custom.min.js"></script>
   <script src="js/jquery/plugins/mouse/jQuery_mousewheel_plugin.js"></script>
   <script src="js/org/gigapan/util.js"></script>
   <script src="js/org/gigapan/timelapse/videoset.js"></script>
   <script src="js/org/gigapan/timelapse/timelapse.js"></script>

   <link href="css/jquery-ui/smoothness/jquery-ui-1.8.6.custom.css" rel="stylesheet" type="text/css"/>
   <style type="text/css">
      body, p, table, tr, td {
         font-family: Verdana, sans-serif;
         font-size: 8pt;
      }

      #timelineSlider {
         margin: 10px;
         width: 500px
      }

      #timelapse {
         cursor: url("css/cursors/openhand.cur")
      }

      #mouse_debug_info {
         border: 1px solid black;
         padding: 3px;
         margin: 3px 0 3px 0;
         width: 500px;
      }

	  .play_mouseover {
	    width:20px;
	    height:23px;
	    background-image: url("images/play_mouseover.png");
	    cursor: pointer;
	    float:left;
	  }

	  .play_mouseout {
	    width:20px;
	    height:23px;
	    background-image: url("images/play_mouseout.png");
	    cursor: pointer;
	    float:left;
	  }

      .pause_mouseover {
	    width:20px;
	    height:23px;
	    background-image: url("images/pause_mouseover.png");
	    cursor: pointer;
	    float:left;
	  }

	  .pause_mouseout {
	    width:20px;
	    height:23px;
	    background-image: url("images/pause_mouseout.png");
	    cursor: pointer;
	    float:left;
	  }

	  .stop_mouseover {
		width:20px;
	    height:22px;
	    background-image: url("images/stop_mouseover.png");
	    cursor: pointer;
	    float:left;
	  }

	  .stop_mouseout {
		width:20px;
	    height:22px;
	    background-image: url("images/stop_mouseout.png");
	    cursor: pointer;
	    float:left;
	  }
   </style>

   <script>
      var timelapseDurationInSeconds = 0.0;
      var timeStepInSecs = 0.04; // 25 frames per second
      var timelapse = null;

      $(document).ready(function()
         {
            timelapse = new org.gigapan.timelapse.Timelapse('../timelapses/brassica1-15m-halfsize/',
                                                            'timelapse',
                                                            {"tile_height":256,"height":3876,"fps":25,"frames":2438,"width":9856,"tile_width":256});

            timelapse.addTimeChangeListener(function(t)
                                                  {
                                                     $("#currentTime").text(org.gigapan.Util.formatTime(t));
                                                     $("#timelineSlider")['slider']("option", "value", t);
                                                  });

            $(this)['keydown'](timelapse.handleKeydownEvent);
            $(this)['keyup'](timelapse.handleKeyupEvent);
            $("#timelapse").mousewheel(timelapse.handleMousescrollEvent);

            window.onunload = timelapse.handleWindowClose;

            timelapseDurationInSeconds = timelapse.getNumFrames() / timelapse.getFps();

            $("#timelapse").bind("mousemove", function(event)
               {
                  var viewerPosition = $("#timelapse").position();
                  var mouseX = event.pageX - viewerPosition.left;
                  var mouseY = event.pageY - viewerPosition.top;
                  $("#window_coords").text("(" + event.pageX + "," + event.pageY + ")");
                  $("#viewer_pixel_coords").text("(" + mouseX + "," + mouseY + ")");
               });

            $("#timelineSlider")['slider']({
                                              animate: true,
                                              value: 0,
                                              min: 0,
                                              max: timelapseDurationInSeconds,
                                              range: "min",
                                              step: timeStepInSecs,
                                              slide: function(e, ui)
                                                 {
                                                    var timeInSecs = ui.value;
                                                    timelapse.seek(timeInSecs);
                                                 }
                                           });

			$('.ui-slider-handle').bind("mouseover", function() {
	      		this.style.cursor = "url('css/cursors/openhand.cur')";
	   		});

	   		$('.ui-slider-handle').bind("mousedown", function() {
	      		this.style.cursor = "url('css/cursors/closedhand.cur')";
	      		$('.ui-slider-handle')['one']('mouseup', function() {
					this.style.cursor = "url('css/cursors/openhand.cur')";
	  	  		});
	   		});

	   		$('.ui-slider').bind("mouseover", function() {
	      		$(this).css("cursor", "pointer");
	   		});

	   		$('#play_toggle').bind("mousemove", function() {
	      		if ($(this).attr("class") == "play_mouseout") $(this).attr("class", "play_mouseover");
	      		else if ($(this).attr("class") == "pause_mouseout") $(this).attr("class", "pause_mouseover");
	   		});

	    	$('#play_toggle').bind("mouseout", function() {
	      		if ($(this).attr("class") == "play_mouseover") $(this).attr("class", "play_mouseout");
	      		else if ($(this).attr("class") == "pause_mouseover") $(this).attr("class", "pause_mouseout");
	    	});

	    	$('#stop').bind("mousemove", function() {
	      		$(this).attr("class", "stop_mouseover");
	    	});

	    	$('#stop').bind("mouseout", function() {
	      		$(this).attr("class", "stop_mouseout");
	    	});

	    	$('#play_toggle').bind("click", function() {
	     		if ($(this).attr("class") == "play_mouseover") {
		   			$(this).attr("class", "pause_mouseout");
		   			$(this).attr("title","Pause");
		   			timelapse.play();
		 		} else {
		   			$(this).attr("class", "play_mouseout");
		   			$(this).attr("title","Play");
		   			timelapse.pause();
		 		}
	   		});

	    	$('#stop').bind("click", function() {
	   	  		if (this.isPaused) return;
	      		$('#play_toggle').attr("class", "play_mouseout");
	      		$('#play_toggle').attr("title","Play");
	      		timelapse.seek(0);
	      		timelapse.pause();
	   	 	});

            $("#totalTime").text(org.gigapan.Util.formatTime(timelapseDurationInSeconds));
         });
   </script>
</head>
<body>

<div style="width:800px; height:450px">
   <div id="timelapse" style="position: absolute; width:800px; height:450px; background:black; overflow:hidden">
   </div>
</div>

<input type="button" value="recenter" onclick="timelapse.warpTo(timelapse.homeView())">
<br>
<input type="button" value="rate -1" onclick="timelapse.setPlaybackRate(-1)">
<input type="button" value="rate -.5" onclick="timelapse.setPlaybackRate(-.5)">
<input type="button" value="rate -.25" onclick="timelapse.setPlaybackRate(-.25)">
<input type="button" value="rate -.1" onclick="timelapse.setPlaybackRate(-.1)">
<input type="button" value="rate .1" onclick="timelapse.setPlaybackRate(.1)">
<input type="button" value="rate .25" onclick="timelapse.setPlaybackRate(.25)">
<input type="button" value="rate .5" onclick="timelapse.setPlaybackRate(.5)">
<input type="button" value="rate 1" onclick="timelapse.setPlaybackRate(1)">

<table border="0" cellpadding="3" cellspacing="0" class="control_panel_widget">
   <tr>
      <td>
         <div id="play_toggle" class="play_mouseout" title="Play"></div>
      </td>
      <td>
         <div id="stop" class="stop_mouseout" title="Stop"></div>
      </td>
      <td colspan="3">
         <div id="timelineSlider"></div>
      </td>
      <td align="right">
         <span id="currentTime">00:00:00</span>/<span id="totalTime">00:00:00</span><br>
      </td>
   </tr>
</table>

<div id="mouse_debug_info">
   <span class="label">Window Coords:</span> <span id="window_coords"></span><br>
   <span class="label">Viewer Pixel Coords:</span> <span id="viewer_pixel_coords"></span><br>
   <span class="label">Viewer Pano Coords:</span> <span id="viewer_pano_coords"></span><br>
   <span class="label">Viewer Bounds:</span> <span id="viewer_bounds"></span><br>
</div>

<br>Debug:
<input id="logVideoStatus" type="checkbox" onclick="timelapse.setStatusLoggingEnabled(this.value)"><label for="logVideoStatus">Log video status</label>
<input id="showNativeVideoControls" type="checkbox" onclick="timelapse.setNativeVideoControlsEnabled(this.value)"><label for="showNativeVideoControls">Show Native Video Controls</label>

</body>
</html>
