/*! KineticJS v4.7.2 2013-09-29 http://www.kineticjs.com by Eric Rowell @ericdrowell - MIT License https://github.com/ericdrowell/KineticJS/wiki/License*/
var Kinetic={};
(function(){Kinetic={version:"4.7.2",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var b=navigator.userAgent.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return{browser:b[1]||"",version:b[2]||"0"}}(),
Filters:{},Node:function(b){this._init(b)},Shape:function(b){this.__init(b)},Container:function(b){this.__init(b)},Stage:function(b){this.___init(b)},Layer:function(b){this.___init(b)},Group:function(b){this.___init(b)},isDragging:function(){var b=Kinetic.DD;return b?b.isDragging:!1},isDragReady:function(){var b=Kinetic.DD;return b?!!b.node:!1},_addId:function(b,a){void 0!==a&&(this.ids[a]=b)},_removeId:function(b){void 0!==b&&delete this.ids[b]},_addName:function(b,a){void 0!==a&&(void 0===this.names[a]&&
(this.names[a]=[]),this.names[a].push(b))},_removeName:function(b,a){if(void 0!==b){var e=this.names[b];if(void 0!==e){for(var d=0;d<e.length;d++)e[d]._id===a&&e.splice(d,1);0===e.length&&delete this.names[b]}}}}})();(function(b,a){"object"===typeof exports?module.exports=a():"function"===typeof define&&define.amd?define(a):b.returnExports=a()})(this,function(){return Kinetic});
(function(){Kinetic.Collection=function(){var c=[].slice.call(arguments),a=c.length,d=0;for(this.length=a;d<a;d++)this[d]=c[d];return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(c){for(var a=0;a<this.length;a++)c(this[a],a)};Kinetic.Collection.prototype.toArray=function(){var c=[],a=this.length,d;for(d=0;d<a;d++)c.push(this[d]);return c};Kinetic.Collection.toCollection=function(c){var a=new Kinetic.Collection,d=c.length,e;for(e=0;e<d;e++)a.push(c[e]);return a};
Kinetic.Collection.mapMethods=function(c){var a=c.length,d;for(d=0;d<a;d++)(function(a){var d=c[a];Kinetic.Collection.prototype[d]=function(){var c=this.length,a;args=[].slice.call(arguments);for(a=0;a<c;a++)this[a][d].apply(this[a],args)}})(d)};Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]};Kinetic.Transform.prototype={translate:function(c,a){this.m[4]+=this.m[0]*c+this.m[2]*a;this.m[5]+=this.m[1]*c+this.m[3]*a},scale:function(c,a){this.m[0]*=c;this.m[1]*=c;this.m[2]*=a;this.m[3]*=a},rotate:function(c){var a=
Math.cos(c);c=Math.sin(c);var d=this.m[1]*a+this.m[3]*c,e=this.m[0]*-c+this.m[2]*a,b=this.m[1]*-c+this.m[3]*a;this.m[0]=this.m[0]*a+this.m[2]*c;this.m[1]=d;this.m[2]=e;this.m[3]=b},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(c,a){var d=this.m[1]+this.m[3]*a,e=this.m[2]+this.m[0]*c,b=this.m[3]+this.m[1]*c;this.m[0]+=this.m[2]*a;this.m[1]=d;this.m[2]=e;this.m[3]=b},multiply:function(c){var a=this.m[1]*c.m[0]+this.m[3]*c.m[1],d=this.m[0]*c.m[2]+this.m[2]*c.m[3],e=this.m[1]*
c.m[2]+this.m[3]*c.m[3],b=this.m[0]*c.m[4]+this.m[2]*c.m[5]+this.m[4],g=this.m[1]*c.m[4]+this.m[3]*c.m[5]+this.m[5];this.m[0]=this.m[0]*c.m[0]+this.m[2]*c.m[1];this.m[1]=a;this.m[2]=d;this.m[3]=e;this.m[4]=b;this.m[5]=g},invert:function(){var c=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),a=-this.m[1]*c,d=-this.m[2]*c,e=this.m[0]*c,b=c*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=c*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*c;this.m[1]=a;this.m[2]=d;this.m[3]=e;this.m[4]=b;this.m[5]=
g},getMatrix:function(){return this.m},setAbsolutePosition:function(c,a){var d=this.m[0],e=this.m[1],b=this.m[2],g=this.m[4],e=(d*(a-this.m[5])-e*(c-g))/(d*this.m[3]-e*b);this.translate((c-g-b*e)/d,e)}};var b=Math.PI/180,a=180/Math.PI,e={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],
green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(c){return!(!c||1!=c.nodeType)},_isFunction:function(c){return!!(c&&c.constructor&&c.call&&c.apply)},_isObject:function(c){return!!c&&c.constructor==Object},_isArray:function(c){return"[object Array]"==Object.prototype.toString.call(c)},_isNumber:function(c){return"[object Number]"==Object.prototype.toString.call(c)},_isString:function(c){return"[object String]"==
Object.prototype.toString.call(c)},_hasMethods:function(c){var a=[],d;for(d in c)this._isFunction(c[d])&&a.push(d);return 0<a.length},_isInDocument:function(c){for(;c=c.parentNode;)if(c==document)return!0;return!1},_simplifyArray:function(c){var a=[],d=c.length,e=Kinetic.Util,b,g;for(b=0;b<d;b++)g=c[b],e._isNumber(g)?g=Math.round(1E3*g)/1E3:e._isString(g)||(g=g.toString()),a.push(g);return a},_getXY:function(c){if(this._isNumber(c))return{x:c,y:c};if(this._isArray(c))if(1===c.length){c=c[0];if(this._isNumber(c))return{x:c,
y:c};if(this._isArray(c))return{x:c[0],y:c[1]};if(this._isObject(c))return c}else{if(2<=c.length)return{x:c[0],y:c[1]}}else if(this._isObject(c))return c;return null},_getSize:function(c){if(this._isNumber(c))return{width:c,height:c};if(this._isArray(c))if(1===c.length){c=c[0];if(this._isNumber(c))return{width:c,height:c};if(this._isArray(c)){if(4<=c.length)return{width:c[2],height:c[3]};if(2<=c.length)return{width:c[0],height:c[1]}}else if(this._isObject(c))return c}else{if(4<=c.length)return{width:c[2],
height:c[3]};if(2<=c.length)return{width:c[0],height:c[1]}}else if(this._isObject(c))return c;return null},_getPoints:function(c){var a=[],d,e;if(void 0===c)return[];e=c.length;if(this._isArray(c[0])){for(d=0;d<e;d++)a.push({x:c[d][0],y:c[d][1]});return a}if(this._isObject(c[0]))return c;for(d=0;d<e;d+=2)a.push({x:c[d],y:c[d+1]});return a},_getImage:function(c,a){var d,e;c?this._isElement(c)?a(c):this._isString(c)?(d=new Image,d.onload=function(){a(d)},d.src=c):c.data?(e=document.createElement("canvas"),
e.width=c.width,e.height=c.height,_context=e.getContext("2d"),_context.putImageData(c,0,0),e=e.toDataURL(),d=new Image,d.onload=function(){a(d)},d.src=e):a(null):a(null)},_rgbToHex:function(c,a,d){return(16777216+(c<<16)+(a<<8)+d).toString(16).slice(1)},_hexToRgb:function(c){c=c.replace("#","");c=parseInt(c,16);return{r:c>>16&255,g:c>>8&255,b:c&255}},getRandomColor:function(){for(var c=(16777215*Math.random()<<0).toString(16);6>c.length;)c="0"+c;return"#"+c},get:function(c,a){return void 0===c?a:
c},getRGB:function(c){return c in e?(c=e[c],{r:c[0],g:c[1],b:c[2]}):"#"===c[0]?this._hexToRgb(c.substring(1)):"rgb("===c.substr(0,4)?(c=d.exec(c.replace(/ /g,"")),{r:parseInt(c[1],10),g:parseInt(c[2],10),b:parseInt(c[3],10)}):{r:0,g:0,b:0}},_merge:function(c,a){var d=this._clone(a),e;for(e in c)this._isObject(c[e])?d[e]=this._merge(c[e],d[e]):d[e]=c[e];return d},_clone:function(c){var a={},d;for(d in c)this._isObject(c[d])?a[d]=this._clone(c[d]):a[d]=c[d];return a},_degToRad:function(c){return c*
b},_radToDeg:function(c){return c*a},_capitalize:function(c){return c.charAt(0).toUpperCase()+c.slice(1)},error:function(c){throw Error("Kinetic error: "+c);},warn:function(c){window.console&&console.warn&&console.warn("Kinetic warning: "+c)},extend:function(c,a){for(var d in a.prototype)d in c.prototype||(c.prototype[d]=a.prototype[d])},addMethods:function(c,a){for(var d in a)c.prototype[d]=a[d]},_getControlPoints:function(c,a,d,e){var b=c.x;c=c.y;var g=a.x;a=a.y;var m=d.x;d=d.y;var n=Math.sqrt(Math.pow(g-
b,2)+Math.pow(a-c,2)),p=Math.sqrt(Math.pow(m-g,2)+Math.pow(d-a,2)),q=e*n/(n+p);e=e*p/(n+p);return[{x:g-q*(m-b),y:a-q*(d-c)},{x:g+e*(m-b),y:a+e*(d-c)}]},_expandPoints:function(a,d){var e=a.length,b=[],k,g;for(k=1;k<e-1;k++)g=Kinetic.Util._getControlPoints(a[k-1],a[k],a[k+1],d),b.push(g[0]),b.push(a[k]),b.push(g[1]);return b},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}})();
(function(){var b=document.createElement("canvas").getContext("2d"),a=(window.devicePixelRatio||1)/(b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1);Kinetic.Canvas=function(a){this.init(a)};Kinetic.Canvas.prototype={init:function(e){e=e||{};this.pixelRatio=e.pixelRatio||Kinetic.pixelRatio||a;this._canvas=document.createElement("canvas");this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=
0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio;this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio;this._canvas.style.height=
a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,d){this.setWidth(a);this.setHeight(d)},toDataURL:function(a,d){try{return this._canvas.toDataURL(a,d)}catch(c){try{return this._canvas.toDataURL()}catch(f){return Kinetic.Util.warn("Unable to get data URL. "+f.message),""}}}};Kinetic.SceneCanvas=function(a){a=a||{};var d=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.SceneContext(this);this.setSize(d,c)};Kinetic.SceneCanvas.prototype=
{setWidth:function(a){var d=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a);c.scale(d,d)},setHeight:function(a){var d=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a);c.scale(d,d)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(a){a=a||{};var d=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.HitContext(this);this.setSize(d,c)};Kinetic.Util.extend(Kinetic.HitCanvas,
Kinetic.Canvas)})();
(function(){var b="arc arcTo beginPath bezierCurveTo clearRect clip closePath createLinearGradient createPattern createRadialGradient drawImage fill fillText getImageData lineTo moveTo putImageData quadraticCurveTo rect restore rotate save scale setLineDash setTransform stroke strokeText transform translate".split(" ");Kinetic.Context=function(a){this.init(a)};Kinetic.Context.prototype={init:function(a){this.canvas=a;this._context=a._canvas.getContext("2d");Kinetic.enableTrace&&(this.traceArr=[],
this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){a.getFillEnabled()&&this._fill(a);a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(a){var e=this.traceArr,d=e.length,c="",f,b,h;for(f=0;f<d;f++)b=e[f],(h=b.method)?(b=b.args,c+=h,c=a?c+"()":Kinetic.Util._isArray(b[0])?c+("(["+b.join(",")+"])"):c+("("+b.join(",")+")")):(c+=b.property,a||(c+="="+b.val)),c+=";";return c},clearTrace:function(){this.traceArr=
[]},_trace:function(a){var e=this.traceArr;e.push(a);e.length>=Kinetic.traceArrMax&&e.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(){var a=[].slice.call(arguments),e=this.getCanvas();a.length?(e=Kinetic.Util._getXY(a),a=Kinetic.Util._getSize(a),this.clearRect(e.x||0,e.y||0,a.width,a.height)):this.clearRect(0,0,e.getWidth(),e.getHeight())},_applyLineCap:function(a){(a=a.getLineCap())&&this.setAttr("lineCap",
a)},_applyOpacity:function(a){a=a.getAbsoluteOpacity();1!==a&&this.setAttr("globalAlpha",a)},_applyLineJoin:function(a){(a=a.getLineJoin())&&this.setAttr("lineJoin",a)},_applyAncestorTransforms:function(a){a=a.getAbsoluteTransform().getMatrix();this.transform(a[0],a[1],a[2],a[3],a[4],a[5])},_clip:function(a){var e=a.getClipX()||0,d=a.getClipY()||0,c=a.getClipWidth(),f=a.getClipHeight();this.save();this._applyAncestorTransforms(a);this.beginPath();this.rect(e,d,c,f);this.clip();this.reset();a._drawChildren(this.getCanvas());
this.restore()},setAttr:function(a,e){this._context[a]=e},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createLinearGradient:function(){var a=arguments;
return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,e=this._context;3===a.length?e.drawImage(a[0],a[1],a[2]):5===a.length?e.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&e.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},
fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;
this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){this._context.rotate(arguments[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,e=this._context;this._context.setLineDash?e.setLineDash(a[0]):"mozDash"in e?e.mozDash=a[0]:"webkitLineDash"in e&&(e.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],
a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a=this,e=b.length,d=Kinetic.Util._simplifyArray,c=this.setAttr,f,l;for(f=0;f<e;f++)(function(c){var e=a[c],f;a[c]=function(){l=d(Array.prototype.slice.call(arguments,
0));f=e.apply(a,arguments);a._trace({method:c,args:l});return f}})(b[f]);a.setAttr=function(){c.apply(a,arguments);a._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)};Kinetic.SceneContext.prototype={_fillColor:function(a){var e=a.getFill();this.setAttr("fillStyle",e);a._fillFunc(this)},_fillPattern:function(a){var e=a.getFillPatternImage(),d=a.getFillPatternX(),c=a.getFillPatternY(),f=a.getFillPatternScale(),b=a.getFillPatternRotation(),
h=a.getFillPatternOffset();a=a.getFillPatternRepeat();(d||c)&&this.translate(d||0,c||0);b&&this.rotate(b);f&&this.scale(f.x,f.y);h&&this.translate(-1*h.x,-1*h.y);this.setAttr("fillStyle",this.createPattern(e,a||"repeat"));this.fill()},_fillLinearGradient:function(a){var e=a.getFillLinearGradientStartPoint(),d=a.getFillLinearGradientEndPoint();a=a.getFillLinearGradientColorStops();e=this.createLinearGradient(e.x,e.y,d.x,d.y);if(a){for(d=0;d<a.length;d+=2)e.addColorStop(a[d],a[d+1]);this.setAttr("fillStyle",
e);this.fill()}},_fillRadialGradient:function(a){var e=a.getFillRadialGradientStartPoint(),d=a.getFillRadialGradientEndPoint(),c=a.getFillRadialGradientStartRadius(),f=a.getFillRadialGradientEndRadius();a=a.getFillRadialGradientColorStops();e=this.createRadialGradient(e.x,e.y,c,d.x,d.y,f);for(d=0;d<a.length;d+=2)e.addColorStop(a[d],a[d+1]);this.setAttr("fillStyle",e);this.fill()},_fill:function(a){var e=a.getFill(),d=a.getFillPatternImage(),c=a.getFillLinearGradientColorStops(),f=a.getFillRadialGradientColorStops(),
b=a.getFillPriority();e&&"color"===b?this._fillColor(a):d&&"pattern"===b?this._fillPattern(a):c&&"linear-gradient"===b?this._fillLinearGradient(a):f&&"radial-gradient"===b?this._fillRadialGradient(a):e?this._fillColor(a):d?this._fillPattern(a):c?this._fillLinearGradient(a):f&&this._fillRadialGradient(a)},_stroke:function(a){var e=a.getStroke(),d=a.getStrokeWidth(),c=a.getDashArray(),f=a.getStrokeScaleEnabled();a.hasStroke()&&(f||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),c&&
a.getDashArrayEnabled()&&this.setLineDash(c),this.setAttr("lineWidth",d||2),this.setAttr("strokeStyle",e||"black"),a._strokeFunc(this),f||this.restore())},_applyShadow:function(a){var e=Kinetic.Util,d=a.getAbsoluteOpacity(),c=e.get(a.getShadowColor(),"black"),f=e.get(a.getShadowBlur(),5),b=e.get(a.getShadowOpacity(),0);a=e.get(a.getShadowOffset(),{x:0,y:0});b&&this.setAttr("globalAlpha",b*d);this.setAttr("shadowColor",c);this.setAttr("shadowBlur",f);this.setAttr("shadowOffsetX",a.x);this.setAttr("shadowOffsetY",
a.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)};Kinetic.HitContext.prototype={_fill:function(a){this.save();this.setAttr("fillStyle",a.colorKey);a._fillFuncHit(this);this.restore()},_stroke:function(a){var e=a.getStroke(),d=a.getStrokeWidth();if(e||d)this._applyLineCap(a),this.setAttr("lineWidth",d||2),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this)}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)})();
(function(){Kinetic.Factory={addGetterSetter:function(b,a,e){this.addGetter(b,a,e);this.addSetter(b,a)},addPointGetterSetter:function(b,a,e){this.addPointGetter(b,a,e);this.addPointSetter(b,a);this.addGetter(b,a+"X",e);this.addGetter(b,a+"Y",e);this.addSetter(b,a+"X");this.addSetter(b,a+"Y")},addBoxGetterSetter:function(b,a,e){this.addBoxGetter(b,a,e);this.addBoxSetter(b,a);this.addGetter(b,a+"X",e);this.addGetter(b,a+"Y",e);this.addGetter(b,a+"Width",e);this.addGetter(b,a+"Height",e);this.addSetter(b,
a+"X");this.addSetter(b,a+"Y");this.addSetter(b,a+"Width");this.addSetter(b,a+"Height")},addPointsGetterSetter:function(b,a){this.addPointsGetter(b,a);this.addPointsSetter(b,a);this.addPointAdder(b,a)},addRotationGetterSetter:function(b,a,e){this.addRotationGetter(b,a,e);this.addRotationSetter(b,a)},addColorGetterSetter:function(b,a){this.addGetter(b,a);this.addSetter(b,a);this.addColorRGBGetter(b,a);this.addColorComponentGetter(b,a,"r");this.addColorComponentGetter(b,a,"g");this.addColorComponentGetter(b,
a,"b");this.addColorRGBSetter(b,a);this.addColorComponentSetter(b,a,"r");this.addColorComponentSetter(b,a,"g");this.addColorComponentSetter(b,a,"b")},addColorRGBGetter:function(b,a){var e="get"+Kinetic.Util._capitalize(a)+"RGB";b.prototype[e]=function(){return Kinetic.Util.getRGB(this.attrs[a])}},addColorComponentGetter:function(b,a,e){var d="get"+Kinetic.Util._capitalize(a);a=d+Kinetic.Util._capitalize(e);b.prototype[a]=function(){return this[d+"RGB"]()[e]}},addPointsGetter:function(b,a){var e="get"+
Kinetic.Util._capitalize(a);b.prototype[e]=function(){var d=this.attrs[a];return void 0===d?[]:d}},addGetter:function(b,a,e){var d="get"+Kinetic.Util._capitalize(a);b.prototype[d]=function(){var c=this.attrs[a];return void 0===c?e:c}},addPointGetter:function(b,a){var e="get"+Kinetic.Util._capitalize(a);b.prototype[e]=function(){return{x:this[e+"X"](),y:this[e+"Y"]()}}},addBoxGetter:function(b,a){var e="get"+Kinetic.Util._capitalize(a);b.prototype[e]=function(){return{x:this[e+"X"](),y:this[e+"Y"](),
width:this[e+"Width"](),height:this[e+"Height"]()}}},addRotationGetter:function(b,a,e){var d="get"+Kinetic.Util._capitalize(a);b.prototype[d]=function(){var c=this.attrs[a];void 0===c&&(c=e);return c};b.prototype[d+"Deg"]=function(){var c=this.attrs[a];void 0===c&&(c=e);return Kinetic.Util._radToDeg(c)}},addColorRGBSetter:function(b,a){var e="set"+Kinetic.Util._capitalize(a)+"RGB";b.prototype[e]=function(d){var c=d&&void 0!==d.r?d.r|0:this.getAttr(a+"R"),e=d&&void 0!==d.g?d.g|0:this.getAttr(a+"G");
d=d&&void 0!==d.b?d.b|0:this.getAttr(a+"B");this._setAttr(a,"#"+Kinetic.Util._rgbToHex(c,e,d))}},addColorComponentSetter:function(b,a,e){var d="set"+Kinetic.Util._capitalize(a);a=d+Kinetic.Util._capitalize(e);b.prototype[a]=function(a){var f={};f[e]=a;this[d+"RGB"](f)}},addPointsSetter:function(b,a){var e="set"+Kinetic.Util._capitalize(a);b.prototype[e]=function(a){a=Kinetic.Util._getPoints(a);this._setAttr("points",a)}},addSetter:function(b,a){var e="set"+Kinetic.Util._capitalize(a);b.prototype[e]=
function(d){this._setAttr(a,d)}},addPointSetter:function(b,a){var e="set"+Kinetic.Util._capitalize(a);b.prototype[e]=function(){var d=Kinetic.Util._getXY([].slice.call(arguments)),c=this.attrs[a],f=0,b=0;if(d){f=d.x;b=d.y;this._fireBeforeChangeEvent(a,c,d);if(void 0!==f)this[e+"X"](f);if(void 0!==b)this[e+"Y"](b);this._fireChangeEvent(a,c,d)}}},addBoxSetter:function(b,a){var e="set"+Kinetic.Util._capitalize(a);b.prototype[e]=function(){var d=[].slice.call(arguments),c=Kinetic.Util._getXY(d),d=Kinetic.Util._getSize(d),
c=Kinetic.Util._merge(c,d),d=this.attrs[a],f,b,h,k;if(c){f=c.x;b=c.y;h=c.width;k=c.height;this._fireBeforeChangeEvent(a,d,c);if(void 0!==f)this[e+"X"](f);if(void 0!==b)this[e+"Y"](b);if(void 0!==h)this[e+"Width"](h);if(void 0!==k)this[e+"Height"](k);this._fireChangeEvent(a,d,c)}}},addRotationSetter:function(b,a){var e="set"+Kinetic.Util._capitalize(a);b.prototype[e]=function(d){this._setAttr(a,d)};b.prototype[e+"Deg"]=function(d){this._setAttr(a,Kinetic.Util._degToRad(d))}},addPointAdder:function(b,
a){var e="add"+Kinetic.Util._removeLastLetter(Kinetic.Util._capitalize(a));b.prototype[e]=function(){var d=Kinetic.Util._getXY([].slice.call(arguments)),c=this.attrs[a];d&&(this._fireBeforeChangeEvent(a,c,d),this.attrs[a].push(d),this._fireChangeEvent(a,c,d))}}}})();
(function(){var b="Shape";Kinetic.Util.addMethods(Kinetic.Node,{_init:function(a){var e=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this.cache={};this.setAttrs(a);this.on("xChange.kinetic yChange.kinetic scaleXChange.kinetic scaleYChange.kinetic skewXChange.kinetic skewYChange.kinetic rotationChange.kinetic offsetXChange.kinetic offsetYChange.kinetic",function(){this._clearCache("transform");e._clearSelfAndChildrenCache("absoluteTransform")});this.on("visibleChange.kinetic",
function(){e._clearSelfAndChildrenCache("visible")});this.on("listeningChange.kinetic",function(){e._clearSelfAndChildrenCache("listening")});this.on("opacityChange.kinetic",function(){e._clearSelfAndChildrenCache("absoluteOpacity")})},clearCache:function(){this.cache={}},_clearCache:function(a){delete this.cache[a]},_getCache:function(a,e){void 0===this.cache[a]&&(this.cache[a]=e.call(this));return this.cache[a]},_clearSelfAndChildrenCache:function(a){this._clearCache(a);this.children&&this.getChildren().each(function(e){e._clearSelfAndChildrenCache(a)})},
on:function(a,e){var d=a.split(" "),c=d.length,f,b,h;for(f=0;f<c;f++)b=d[f],h=b.split("."),b=h[0],h=h[1]||"",this.eventListeners[b]||(this.eventListeners[b]=[]),this.eventListeners[b].push({name:h,handler:e});return this},off:function(a){a=a.split(" ");var e=a.length,d,c,f,b;for(d=0;d<e;d++)if(f=a[d],b=f.split("."),f=b[0],b=b[1],f)this.eventListeners[f]&&this._off(f,b);else for(c in this.eventListeners)this._off(c,b);return this},remove:function(){var a=this.getParent();a&&a.children&&(a.children.splice(this.index,
1),a._setChildrenIndices(),delete this.parent);this._clearSelfAndChildrenCache("stage");this._clearSelfAndChildrenCache("absoluteTransform");this._clearSelfAndChildrenCache("visible");this._clearSelfAndChildrenCache("listening");this._clearSelfAndChildrenCache("absoluteOpacity");return this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(a){var e="get"+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[e])?
this[e]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),e=new Kinetic.Collection;a;)e.push(a),a=a.getParent();return e},setAttr:function(){var a=Array.prototype.slice.call(arguments),e=a[0],d=this["set"+Kinetic.Util._capitalize(e)];a.shift();Kinetic.Util._isFunction(d)?d.apply(this,a):this.attrs[e]=a[0];return this},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var e,d;if(a)for(e in a)if("children"!==e)if(d="set"+Kinetic.Util._capitalize(e),Kinetic.Util._isFunction(this[d]))this[d](a[e]);
else this._setAttr(e,a[e]);return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var a=this.getListening(),e=this.getParent();return a&&e&&!e.isListening()?!1:a},isVisible:function(){return this._getCache("visible",this._isVisible)},_isVisible:function(){var a=this.getVisible(),e=this.getParent();return a&&e&&!e.isVisible()?!1:a},show:function(){this.setVisible(!0);return this},hide:function(){this.setVisible(!1);return this},getZIndex:function(){return this.index||
0},getAbsoluteZIndex:function(){function a(g){f=[];l=g.length;for(h=0;h<l;h++)k=g[h],c++,k.nodeType!==b&&(f=f.concat(k.getChildren().toArray())),k._id===d._id&&(h=l);0<f.length&&f[0].getLevel()<=e&&a(f)}var e=this.getLevel(),d=this,c=0,f,l,h,k;"Stage"!==d.nodeType&&a(d.getStage().getChildren());return c},getLevel:function(){for(var a=0,e=this.parent;e;)a++,e=e.parent;return a},setPosition:function(){var a=Kinetic.Util._getXY([].slice.call(arguments));this.setX(a.x);this.setY(a.y);return this},getPosition:function(){return{x:this.getX(),
y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),e=new Kinetic.Transform,d=this.getOffset();e.m=a.slice();e.translate(d.x,d.y);return e.getTranslation()},setAbsolutePosition:function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),e=this._clearTransform(),d;this.attrs.x=e.x;this.attrs.y=e.y;delete e.x;delete e.y;d=this.getAbsoluteTransform();d.invert();d.translate(a.x,a.y);a={x:this.attrs.x+d.getTranslation().x,y:this.attrs.y+d.getTranslation().y};
this.setPosition(a.x,a.y);this._setTransform(e);return this},_setTransform:function(a){for(var e in a)this.attrs[e]=a[e];this._clearCache("transform");this._clearSelfAndChildrenCache("absoluteTransform")},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=
1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache("transform");this._clearSelfAndChildrenCache("absoluteTransform");return a},move:function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),e=this.getX(),d=this.getY();void 0!==a.x&&(e+=a.x);void 0!==a.y&&(d+=a.y);this.setPosition(e,d);return this},_eachAncestorReverse:function(a,e){var d=[],c=this.getParent(),b;for(e&&d.unshift(this);c;)d.unshift(c),c=c.parent;c=d.length;for(b=
0;b<c;b++)a(d[b])},rotate:function(a){this.setRotation(this.getRotation()+a);return this},rotateDeg:function(a){this.setRotation(this.getRotation()+Kinetic.Util._degToRad(a));return this},moveToTop:function(){this.parent.children.splice(this.index,1);this.parent.children.push(this);this.parent._setChildrenIndices();return!0},moveUp:function(){var a=this.index,e=this.parent.getChildren().length;return a<e-1?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),
!0):!1},moveDown:function(){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){this.parent.children.splice(this.index,1);this.parent.children.splice(a,0,this);this.parent._setChildrenIndices();return this},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",
this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();this.getParent()&&(a*=this.getParent().getAbsoluteOpacity());return a},moveTo:function(a){Kinetic.Node.prototype.remove.call(this);a.add(this);return this},toObject:function(){var a=Kinetic.Util,e={},d=this.getAttrs(),c,b;e.attrs={};for(c in d)b=d[c],a._isFunction(b)||a._isElement(b)||a._isObject(b)&&a._hasMethods(b)||(e.attrs[c]=b);e.className=this.getClassName();return e},toJSON:function(){return JSON.stringify(this.toObject())},
getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var a=this.getParent();if(a)return a.getStage()},fire:function(a,e,d){d?this._fireAndBubble(a,e||{}):this._fire(a,e||{});return this},getAbsoluteTransform:function(){return this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var a=new Kinetic.Transform,e;this._eachAncestorReverse(function(d){e=
d.getTransform();a.multiply(e)},!0);return a},_getTransform:function(){var a=new Kinetic.Transform,e=this.getX(),d=this.getY(),c=this.getRotation(),b=this.getScaleX(),l=this.getScaleY(),h=this.getSkewX(),k=this.getSkewY(),g=this.getOffsetX(),m=this.getOffsetY();0===e&&0===d||a.translate(e,d);0!==c&&a.rotate(c);0===h&&0===k||a.skew(h,k);1===b&&1===l||a.scale(b,l);0===g&&0===m||a.translate(-1*g,-1*m);return a},clone:function(a){var e=this.getClassName(),e=new Kinetic[e](this.attrs),d,c,b,l,h;for(d in this.eventListeners)for(c=
this.eventListeners[d],b=c.length,l=0;l<b;l++)h=c[l],0>h.name.indexOf("kinetic")&&(e.eventListeners[d]||(e.eventListeners[d]=[]),e.eventListeners[d].push(h));e.setAttrs(a);return e},toDataURL:function(a){a=a||{};var e=a.mimeType||null,d=a.quality||null,c=this.getStage(),b=a.x||0,l=a.y||0;a=new Kinetic.SceneCanvas({width:a.width||c.getWidth(),height:a.height||c.getHeight(),pixelRatio:1});c=a.getContext();c.save();(b||l)&&c.translate(-1*b,-1*l);this.drawScene(a);c.restore();return a.toDataURL(e,d)},
toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(e){a.callback(e)})},setSize:function(){var a=Kinetic.Util._getSize(Array.prototype.slice.call(arguments));this.setWidth(a.width);this.setHeight(a.height);return this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},
_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,e){var d=this.eventListeners[a],c,b;for(c=0;c<d.length;c++)if(b=d[c].name,!("kinetic"===b&&"kinetic"!==e||e&&b!==e)){d.splice(c,1);if(0===d.length){delete this.eventListeners[a];break}c--}},_fireBeforeChangeEvent:function(a,e,d){this._fire("before"+Kinetic.Util._capitalize(a)+"Change",{oldVal:e,newVal:d})},_fireChangeEvent:function(a,e,d){this._fire(a+"Change",{oldVal:e,newVal:d})},setId:function(a){var e=this.getId();Kinetic._removeId(e);
Kinetic._addId(this,a);this._setAttr("id",a);return this},setName:function(a){var e=this.getName();Kinetic._removeName(e,this._id);Kinetic._addName(this,a);this._setAttr("name",a);return this},_setAttr:function(a,e){var d;void 0!==e&&(d=this.attrs[a],this._fireBeforeChangeEvent(a,d,e),this.attrs[a]=e,this._fireChangeEvent(a,d,e))},_fireAndBubble:function(a,e,d){var c=!0;e&&this.nodeType===b&&(e.targetNode=this);"mouseenter"===a&&d&&this._id===d._id?c=!1:"mouseleave"===a&&d&&this._id===d._id&&(c=!1);
c&&(this._fire(a,e),e&&!e.cancelBubble&&this.parent&&(d&&d.parent?this._fireAndBubble.call(this.parent,a,e,d.parent):this._fireAndBubble.call(this.parent,a,e)))},_fire:function(a,e){var d=this.eventListeners[a],c,b;if(d)for(c=d.length,b=0;b<c;b++)d[b].handler.call(this,e)},draw:function(){this.drawScene();this.drawHit();return this},shouldDrawHit:function(){return this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},isDraggable:function(){return!1},getTransform:function(){return this._getCache("transform",
this._getTransform)}});Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)};Kinetic.Node._createNode=function(a,b){var d=Kinetic.Node.prototype.getClassName.call(a),c=a.children,f,l;b&&(a.attrs.container=b);d=new Kinetic[d](a.attrs);if(c)for(f=c.length,l=0;l<f;l++)d.add(this._createNode(c[l]));return d};Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,
"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addRotationGetterSetter(Kinetic.Node,"rotation",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"scale",1);Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"skew",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"offset",0);Kinetic.Factory.addSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening",!0);Kinetic.Factory.addGetterSetter(Kinetic.Node,
"visible",!0);Kinetic.Collection.mapMethods("on off remove destroy show hide move rotate moveToTop moveUp moveDown moveToBottom moveTo fire draw".split(" "))})();
(function(){function b(a){window.setTimeout(a,1E3/60)}Kinetic.Animation=function(a,d){this.func=a;this.setLayers(d);this.id=Kinetic.Animation.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}};Kinetic.Animation.prototype={setLayers:function(a){var d=[];this.layers=d=a?0<a.length?a:[a]:[]},getLayers:function(){return this.layers},addLayer:function(a){var d=this.layers,c,b;if(d)for(c=d.length,b=0;b<c;b++){if(d[b]._id===a._id)return!1}else this.layers=[];this.layers.push(a);
return!0},isRunning:function(){for(var a=Kinetic.Animation.animations,d=0;d<a.length;d++)if(a[d].id===this.id)return!0;return!1},start:function(){this.stop();this.frame.timeDiff=0;this.frame.lastTime=(new Date).getTime();Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime;this.frame.lastTime=a;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1E3/this.frame.timeDiff}};Kinetic.Animation.animations=
[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=!1;Kinetic.Animation._addAnimation=function(a){this.animations.push(a);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(a){a=a.id;for(var d=this.animations,c=d.length,b=0;b<c;b++)if(d[b].id===a){this.animations.splice(b,1);break}};Kinetic.Animation._runFrames=function(){var a={},d=this.animations,c,b,l,h,k,g,m,n;for(h=0;h<d.length;h++){c=d[h];b=c.layers;l=c.func;c._updateFrameObject((new Date).getTime());g=b.length;
for(k=0;k<g;k++)m=b[k],void 0!==m._id&&(a[m._id]=m);l&&l.call(c,c.frame)}for(n in a)a[n].draw()};Kinetic.Animation._animationLoop=function(){var a=this;0<this.animations.length?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){a._animationLoop()})):this.animRunning=!1};Kinetic.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};RAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||b;Kinetic.Animation.requestAnimFrame=function(a){(Kinetic.DD&&Kinetic.DD.isDragging?b:RAF)(a)};var a=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(b){a.call(this,b)};Kinetic.Layer.prototype.batchDraw=function(){var a=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){a.lastBatchDrawTime&&500<(new Date).getTime()-a.lastBatchDrawTime&&a.batchAnim.stop()},this));this.lastBatchDrawTime=(new Date).getTime();this.batchAnim.isRunning()||
(this.draw(),this.batchAnim.start())};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}})();
(function(){var b={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=0;Kinetic.Tween=function(d){var c=this,f=d.node,l=f._id,h=d.duration||1,k=d.easing||Kinetic.Easings.Linear,g=!!d.yoyo,m;this.node=f;this._id=a++;this.anim=new Kinetic.Animation(function(){c.tween.onEnterFrame()},f.getLayer()||f.getLayers());this.tween=new e(m,function(a){c._tweenFunc(a)},k,0,1,1E3*h,g);this._addListeners();Kinetic.Tween.attrs[l]||(Kinetic.Tween.attrs[l]={});Kinetic.Tween.attrs[l][this._id]||(Kinetic.Tween.attrs[l][this._id]=
{});Kinetic.Tween.tweens[l]||(Kinetic.Tween.tweens[l]={});for(m in d)void 0===b[m]&&this._addAttr(m,d[m]);this.reset();this.onFinish=d.onFinish;this.onReset=d.onReset};Kinetic.Tween.attrs={};Kinetic.Tween.tweens={};Kinetic.Tween.prototype={_addAttr:function(a,c){var b=this.node,e=b._id,h,k,g,m,n;(h=Kinetic.Tween.tweens[e][a])&&delete Kinetic.Tween.attrs[e][h][a];b=b.getAttr(a);if(Kinetic.Util._isArray(c))for(c=Kinetic.Util._getPoints(c),h=[],g=c.length,k=0;k<g;k++)m=b[k],n=c[k],h.push({x:n.x-m.x,
y:n.y-m.y});else h=c-b;Kinetic.Tween.attrs[e][this._id][a]={start:b,diff:h};Kinetic.Tween.tweens[e][a]=this._id},_tweenFunc:function(a){var c=this.node,b=Kinetic.Tween.attrs[c._id][this._id],e,h,k,g,m,n,p,q;for(e in b){h=b[e];k=h.start;h=h.diff;if(Kinetic.Util._isArray(k))for(g=[],n=k.length,m=0;m<n;m++)p=k[m],q=h[m],g.push({x:p.x+q.x*a,y:p.y+q.y*a});else g=k+h*a;c.setAttr(e,g)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()};this.tween.onReverse=function(){a.anim.start()};
this.tween.onPause=function(){a.anim.stop()};this.tween.onFinish=function(){if(a.onFinish)a.onFinish()};this.tween.onReset=function(){if(a.onReset)a.onReset()}},play:function(){this.tween.play();return this},reverse:function(){this.tween.reverse();return this},reset:function(){var a=this.node;this.tween.reset();(a.getLayer()||a.getLayers()).draw();return this},seek:function(a){var c=this.node;this.tween.seek(1E3*a);(c.getLayer()||c.getLayers()).draw();return this},pause:function(){this.tween.pause();
return this},finish:function(){var a=this.node;this.tween.finish();(a.getLayer()||a.getLayers()).draw();return this},destroy:function(){var a=this.node._id,c=this._id,b=Kinetic.Tween.tweens[a],e;this.pause();for(e in b)delete Kinetic.Tween.tweens[a][e];delete Kinetic.Tween.attrs[a][c]}};var e=function(a,c,b,e,h,k,g){this.prop=a;this.propFunc=c;this._pos=this.begin=e;this.duration=k;this.prevPos=this._change=0;this.yoyo=g;this._finish=this._startTime=this._position=this._time=0;this.func=b;this._change=
h-this.begin;this.pause()};e.prototype={fire:function(a){(a=this[a])&&a()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos;this.propFunc(a);this._pos=a},getPosition:function(a){void 0===a&&(a=this._time);return this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=
2;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},reverse:function(){this.state=3;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(a){this.pause();this._time=a;this.update();this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},
onEnterFrame:function(){var a=this.getTimer()-this._startTime;2===this.state?this.setTime(a):3===this.state&&this.setTime(this.duration-a)},pause:function(){this.state=1;this.fire("onPause")},getTimer:function(){return(new Date).getTime()}};Kinetic.Easings={BackEaseIn:function(a,c,b,e,h,k){return b*(a/=e)*a*(2.70158*a-1.70158)+c},BackEaseOut:function(a,c,b,e,h,k){return b*((a=a/e-1)*a*(2.70158*a+1.70158)+1)+c},BackEaseInOut:function(a,c,b,e,h,k){h=1.70158;return 1>(a/=e/2)?b/2*a*a*(((h*=1.525)+1)*
a-h)+c:b/2*((a-=2)*a*(((h*=1.525)+1)*a+h)+2)+c},ElasticEaseIn:function(a,c,b,e,h,k){var g=0;if(0===a)return c;if(1==(a/=e))return c+b;k||(k=0.3*e);!h||h<Math.abs(b)?(h=b,g=k/4):g=k/(2*Math.PI)*Math.asin(b/h);return-(h*Math.pow(2,10*(a-=1))*Math.sin(2*(a*e-g)*Math.PI/k))+c},ElasticEaseOut:function(a,c,b,e,h,k){var g=0;if(0===a)return c;if(1==(a/=e))return c+b;k||(k=0.3*e);!h||h<Math.abs(b)?(h=b,g=k/4):g=k/(2*Math.PI)*Math.asin(b/h);return h*Math.pow(2,-10*a)*Math.sin(2*(a*e-g)*Math.PI/k)+b+c},ElasticEaseInOut:function(a,
c,b,e,h,k){var g=0;if(0===a)return c;if(2==(a/=e/2))return c+b;k||(k=0.3*1.5*e);!h||h<Math.abs(b)?(h=b,g=k/4):g=k/(2*Math.PI)*Math.asin(b/h);return 1>a?-0.5*h*Math.pow(2,10*(a-=1))*Math.sin(2*(a*e-g)*Math.PI/k)+c:0.5*h*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*e-g)*Math.PI/k)+b+c},BounceEaseOut:function(a,c,b,e){return(a/=e)<1/2.75?7.5625*b*a*a+c:a<2/2.75?b*(7.5625*(a-=1.5/2.75)*a+0.75)+c:a<2.5/2.75?b*(7.5625*(a-=2.25/2.75)*a+0.9375)+c:b*(7.5625*(a-=2.625/2.75)*a+0.984375)+c},BounceEaseIn:function(a,c,
b,e){return b-Kinetic.Easings.BounceEaseOut(e-a,0,b,e)+c},BounceEaseInOut:function(a,c,b,e){return a<e/2?0.5*Kinetic.Easings.BounceEaseIn(2*a,0,b,e)+c:0.5*Kinetic.Easings.BounceEaseOut(2*a-e,0,b,e)+0.5*b+c},EaseIn:function(a,c,b,e){return b*(a/=e)*a+c},EaseOut:function(a,c,b,e){return-b*(a/=e)*(a-2)+c},EaseInOut:function(a,c,b,e){return 1>(a/=e/2)?b/2*a*a+c:-b/2*(--a*(a-2)-1)+c},StrongEaseIn:function(a,c,b,e){return b*(a/=e)*a*a*a*a+c},StrongEaseOut:function(a,c,b,e){return b*((a=a/e-1)*a*a*a*a+1)+
c},StrongEaseInOut:function(a,c,b,e){return 1>(a/=e/2)?b/2*a*a*a*a*a+c:b/2*((a-=2)*a*a*a*a+2)+c},Linear:function(a,c,b,e){return b*a/e+c}}})();
(function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,c=b.node;c&&(c._setDragPosition(a),b.isDragging||(b.isDragging=!0,c.fire("dragstart",a,!0)),c.fire("dragmove",a,!0))},_endDragBefore:function(a){var b=Kinetic.DD,c=b.node,f;c&&(f=c.getLayer(),b.anim.stop(),b.isDragging&&(b.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=c)),delete b.node,(f||c).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&
b.fire("dragend",a,!0)}};Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),b=b.getPointerPosition(),f=this.getAbsolutePosition();b&&(a.node&&a.node.stopDrag(),a.node=this,a.offset.x=b.x-f.x,a.offset.y=b.y-f.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())};Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),f=this.getDragBoundFunc(),b={x:c.x-b.offset.x,y:c.y-b.offset.y};
void 0!==f&&(b=f.call(this,b,a));this.setAbsolutePosition(b)};Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b);a._endDragAfter(b)};Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a);this._dragChange()};var b=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var a=Kinetic.DD;a.node&&a.node._id===this._id&&this.stopDrag();b.call(this)};Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===
this._id&&a.isDragging};Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup();if("Stage"===this.getClassName())this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)});else this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===
this._id&&b.node.stopDrag()}};Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic");this.off("touchstart.kinetic")};Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1);Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var a=document.getElementsByTagName("html")[0];a.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0);a.addEventListener("touchend",Kinetic.DD._endDragBefore,!0);a.addEventListener("mouseup",
Kinetic.DD._endDragAfter,!1);a.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)})();
(function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(b){this.children=new Kinetic.Collection;Kinetic.Node.call(this,b)},getChildren:function(){return this.children},hasChildren:function(){return 0<this.getChildren().length},removeChildren:function(){for(var b=this.children,a;0<b.length;)a=b[0],a.hasChildren()&&a.removeChildren(),a.remove();return this},destroyChildren:function(){for(var b=this.children;0<b.length;)b[0].destroy();return this},add:function(b){var a=this.children;this._validateAdd(b);
b.index=a.length;b.parent=this;a.push(b);this._fire("add",{child:b});return this},destroy:function(){this.hasChildren()&&this.destroyChildren();Kinetic.Node.prototype.destroy.call(this)},find:function(b){var a=[];b=b.replace(/ /g,"").split(",");var e=b.length,d,c,f,l,h;for(d=0;d<e;d++)if(f=b[d],"#"===f.charAt(0))(c=this._getNodeById(f.slice(1)))&&a.push(c);else if("."===f.charAt(0))c=this._getNodesByName(f.slice(1)),a=a.concat(c);else for(l=this.getChildren(),h=l.length,c=0;c<h;c++)a=a.concat(l[c]._get(f));
return Kinetic.Collection.toCollection(a)},_getNodeById:function(b){b=Kinetic.ids[b];return void 0!==b&&this.isAncestorOf(b)?b:null},_getNodesByName:function(b){return this._getDescendants(Kinetic.names[b]||[])},_get:function(b){for(var a=Kinetic.Node.prototype._get.call(this,b),e=this.getChildren(),d=e.length,c=0;c<d;c++)a=a.concat(e[c]._get(b));return a},toObject:function(){var b=Kinetic.Node.prototype.toObject.call(this);b.children=[];for(var a=this.getChildren(),e=a.length,d=0;d<e;d++)b.children.push(a[d].toObject());
return b},_getDescendants:function(b){for(var a=[],e=b.length,d=0;d<e;d++){var c=b[d];this.isAncestorOf(c)&&a.push(c)}return a},isAncestorOf:function(b){for(b=b.getParent();b;){if(b._id===this._id)return!0;b=b.getParent()}return!1},clone:function(b){var a=Kinetic.Node.prototype.clone.call(this,b);this.getChildren().each(function(b){a.add(b.clone())});return a},getAllIntersections:function(){for(var b=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),a=[],e=this.find("Shape"),d=e.length,c=
0;c<d;c++){var f=e[c];f.isVisible()&&f.intersects(b)&&a.push(f)}return a},_setChildrenIndices:function(){this.children.each(function(b,a){b.index=a})},drawScene:function(b){var a=this.getLayer(),e=this.getClipWidth()&&this.getClipHeight();!b&&a&&(b=a.getCanvas());this.isVisible()&&(e?b.getContext()._clip(this):this._drawChildren(b));return this},_drawChildren:function(b){this.children.each(function(a){a.drawScene(b)})},drawHit:function(){var b=this.getClipWidth()&&this.getClipHeight()&&"Stage"!==
this.nodeType,a=0,e=0,d=[],c;if(this.shouldDrawHit()){b&&(c=this.getLayer().hitCanvas,c.getContext()._clip(this));d=this.children;e=d.length;for(a=0;a<e;a++)d[a].drawHit();b&&c.getContext()._context.restore()}return this}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addBoxGetterSetter(Kinetic.Container,"clip")})();
(function(){function b(a){a.fill()}function a(a){a.stroke()}function e(a){a.fill()}function d(a){a.stroke()}function c(){this._clearCache(f)}var f="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(f){this.nodeType="Shape";this._fillFunc=b;this._strokeFunc=a;this._fillFuncHit=e;this._strokeFuncHit=d;for(var h=Kinetic.shapes,k;!(k=Kinetic.Util.getRandomColor())||k in h;);this.colorKey=k;h[k]=this;Kinetic.Node.call(this,f);this._setDrawFuncs();this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic",
c)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(f,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||
this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!(!this.getStroke()&&!this.getStrokeWidth())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(){var a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),c=this.getStage().bufferHitCanvas;c.getContext().clear();this.drawScene(c);return 0<c.context.getImageData(a.x|0,a.y|0,1,1).data[3]},enableFill:function(){this._setAttr("fillEnabled",!0);
return this},disableFill:function(){this._setAttr("fillEnabled",!1);return this},enableStroke:function(){this._setAttr("strokeEnabled",!0);return this},disableStroke:function(){this._setAttr("strokeEnabled",!1);return this},enableStrokeScale:function(){this._setAttr("strokeScaleEnabled",!0);return this},disableStrokeScale:function(){this._setAttr("strokeScaleEnabled",!1);return this},enableShadow:function(){this._setAttr("shadowEnabled",!0);return this},disableShadow:function(){this._setAttr("shadowEnabled",
!1);return this},enableDashArray:function(){this._setAttr("dashArrayEnabled",!0);return this},disableDashArray:function(){this._setAttr("dashArrayEnabled",!1);return this},destroy:function(){Kinetic.Node.prototype.destroy.call(this);delete Kinetic.shapes[this.colorKey];return this},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(a){a=(a||this.getLayer().getCanvas()).getContext();var c=this.getDrawFunc(),b=this.hasShadow(),
d,e;c&&this.isVisible()&&(this._useBufferCanvas()?(d=this.getStage(),d=d.bufferCanvas,e=d.getContext(),e.clear(),e.save(),e._applyLineJoin(this),e._applyAncestorTransforms(this),c.call(this,e),e.restore(),a.save(),b&&(a.save(),a._applyShadow(this),a.drawImage(d._canvas,0,0),a.restore()),a._applyOpacity(this),a.drawImage(d._canvas,0,0)):(a.save(),a._applyLineJoin(this),a._applyAncestorTransforms(this),b&&(a.save(),a._applyShadow(this),c.call(this,a),a.restore()),a._applyOpacity(this),c.call(this,a)),
a.restore());return this},drawHit:function(){var a=this.getAttrs(),a=a.drawHitFunc||a.drawFunc,c=this.getLayer().hitCanvas.getContext();a&&this.shouldDrawHit()&&(c.save(),c._applyLineJoin(this),c._applyAncestorTransforms(this),a.call(this,c),c.restore());return this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc);!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,
"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawHitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArray");Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"shadowOpacity");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius");Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",
!0);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternScale",1);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",0);Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,
"shadowOffset",0);Kinetic.Factory.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)})();
(function(){function b(c,b){c.content.addEventListener(b,function(d){c[a+b](d)},!1)}var a="_",e="mousedown mousemove mouseup mouseout touchstart touchmove touchend mouseover".split(" "),d=e.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType="Stage";Kinetic.Container.call(this,a);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},
setContainer:function(a){"string"===typeof a&&(a=document.getElementById(a));this._setAttr("container",a);return this},draw:function(){Kinetic.Node.prototype.draw.call(this);return this},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this._resizeDOM();return this},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this._resizeDOM();return this},clear:function(){var a=this.children,b=a.length,d;for(d=0;d<b;d++)a[d].clear();return this},destroy:function(){var a=this.content;
Kinetic.Container.prototype.destroy.call(this);a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(g){var k=p[g].toDataURL(),s=new Image;s.onload=function(){n.drawImage(s,0,0);g<p.length-
1?b(g+1):a.callback(m.toDataURL(d,e))};s.src=k}a=a||{};var d=a.mimeType||null,e=a.quality||null,k=a.x||0,g=a.y||0,m=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),n=m.getContext()._context,p=this.children;(k||g)&&n.translate(-1*k,-1*g);b(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})};this.toDataURL(a)},getIntersection:function(){var a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),
b=this.getChildren(),d,e;for(d=b.length-1;0<=d;d--)if(e=b[d].getIntersection(a))return e;return null},_resizeDOM:function(){if(this.content){var a=this.getWidth(),b=this.getHeight(),d=this.getChildren(),e=d.length,k,g;this.content.style.width=a+"px";this.content.style.height=b+"px";this.bufferCanvas.setSize(a,b);this.bufferHitCanvas.setSize(a,b);for(k=0;k<e;k++)g=d[k],g.getCanvas().setSize(a,b),g.hitCanvas.setSize(a,b),g.draw()}},add:function(a){Kinetic.Container.prototype.add.call(this,a);a.canvas.setSize(this.attrs.width,
this.attrs.height);a.hitCanvas.setSize(this.attrs.width,this.attrs.height);a.draw();this.content.appendChild(a.canvas._canvas);return this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(a){a||(a=window.event);this._setMousePosition(a);this._setTouchPosition(a)},_bindContentEvents:function(){var a;for(a=0;a<d;a++)b(this,e[a])},_mouseover:function(a){this._fire("contentMouseover",a)},_mouseout:function(a){this._setPointerPosition(a);
var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble("mouseout",a),b._fireAndBubble("mouseleave",a),this.targetShape=null);this.mousePos=void 0;this._fire("contentMouseout",a)},_mousemove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,d=this.getIntersection(this.getPointerPosition()),e=d&&d.shape?d.shape:void 0;e?Kinetic.isDragging()||255!==d.pixel[3]||this.targetShape&&this.targetShape._id===e._id?e._fireAndBubble("mousemove",a):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",
a,e),this.targetShape._fireAndBubble("mouseleave",a,e)),e._fireAndBubble("mouseover",a,this.targetShape),e._fireAndBubble("mouseenter",a,this.targetShape),this.targetShape=e):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble("mouseout",a),this.targetShape._fireAndBubble("mouseleave",a),this.targetShape=null);this._fire("contentMousemove",a);b&&b._drag(a);a.preventDefault&&a.preventDefault()},_mousedown:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),
b=b&&b.shape?b.shape:void 0;Kinetic.listenClickTap=!0;b&&(this.clickStartShape=b,b._fireAndBubble("mousedown",a));this._fire("contentMousedown");a.preventDefault&&a.preventDefault()},_mouseup:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),b=b&&b.shape?b.shape:void 0,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&(b._fireAndBubble("mouseup",
a),Kinetic.listenClickTap&&this.clickStartShape&&b._id===this.clickStartShape._id&&(b._fireAndBubble("click",a),d&&b._fireAndBubble("dblclick",a)));this._fire("contentMouseup");Kinetic.listenClickTap&&(this._fire("contentClick",a),d&&this._fire("contentDblclick",a));Kinetic.listenClickTap=!1;a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),b=b&&b.shape?b.shape:void 0;Kinetic.listenClickTap=!0;b&&(this.tapStartShape=
b,b._fireAndBubble("touchstart",a),b.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchstart",a)},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),b=b&&b.shape?b.shape:void 0,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&(b._fireAndBubble("touchend",a),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&
(b._fireAndBubble("tap",a),d&&b._fireAndBubble("dbltap",a)),b.isListening()&&a.preventDefault&&a.preventDefault());Kinetic.listenClickTap&&(this._fire("contentTouchend",a),d&&this._fire("contentDbltap",a));Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,d=this.getIntersection(this.getPointerPosition());if(d=d&&d.shape?d.shape:void 0)d._fireAndBubble("touchmove",a),d.isListening()&&a.preventDefault&&a.preventDefault();this._fire("contentTouchmove",a);
b&&b._drag(a)},_setMousePosition:function(a){var b=this._getContentPosition(),d=a.offsetX,e=a.clientX,k=0,g=0;void 0!==d?(k=d,g=a.offsetY):"mozilla"===Kinetic.UA.browser?(k=a.layerX,g=a.layerY):void 0!==e&&b&&(k=e-b.left,g=a.clientY-b.top);this.mousePos={x:k,y:g}},_setTouchPosition:function(a){var b=this._getContentPosition(),d;void 0!==a.touches&&1===a.touches.length&&(d=a.touches[0],a=d.clientX-b.left,b=d.clientY-b.top,this.touchPos={x:a,y:b})},_getContentPosition:function(){var a=this.content.getBoundingClientRect();
return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();a.innerHTML="";this.content=document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";a.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas;this.bufferHitCanvas=new Kinetic.HitCanvas;this._resizeDOM()},_onContent:function(a,b){var d=a.split(" "),e=d.length,k,g;for(k=0;k<e;k++)g=d[k],this.content.addEventListener(g,
b,!1)}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container")})();
(function(){Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(b){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;this.hitCanvas=new Kinetic.HitCanvas;Kinetic.Container.call(this,b)},_validateAdd:function(b){b=b.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(){var b=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),a;if(this.isVisible()&&this.isListening()){b=this.hitCanvas.context._context.getImageData(b.x|
0,b.y|0,1,1).data;if(255===b[3])return a=Kinetic.Util._rgbToHex(b[0],b[1],b[2]),a=Kinetic.shapes["#"+a],{shape:a,pixel:b};if(0<b[0]||0<b[1]||0<b[2]||0<b[3])return{pixel:b}}return null},drawScene:function(b){b=b||this.getCanvas();this._fire("beforeDraw",{node:this});this.getClearBeforeDraw()&&b.getContext().clear();Kinetic.Container.prototype.drawScene.call(this,b);this._fire("draw",{node:this});return this},drawHit:function(){var b=this.getLayer();b&&b.getClearBeforeDraw()&&b.getHitCanvas().getContext().clear();
Kinetic.Container.prototype.drawHit.call(this);return this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){var b=this.getContext(),a=this.getHitCanvas().getContext();b.clear.apply(b,arguments);a.clear.apply(a,arguments);return this},setVisible:function(b){Kinetic.Node.prototype.setVisible.call(this,b);b?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display=
"block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none");return this},setZIndex:function(b){Kinetic.Node.prototype.setZIndex.call(this,b);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),b<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[b+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas));return this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var b=
this.getStage();b&&(b.content.removeChild(this.getCanvas()._canvas),b.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var b=this.getStage();b&&(b.content.removeChild(this.getCanvas()._canvas),this.index<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var b=
this.getStage();if(b){var a=b.getChildren();b.content.removeChild(this.getCanvas()._canvas);b.content.insertBefore(this.getCanvas()._canvas,a[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var b=this.getStage();if(b){var a=b.getChildren();b.content.removeChild(this.getCanvas()._canvas);b.content.insertBefore(this.getCanvas()._canvas,a[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var b=this.getStage(),
a=this.getCanvas()._canvas;Kinetic.Node.prototype.remove.call(this);b&&a&&Kinetic.Util._isInDocument(a)&&b.content.removeChild(a);return this},getStage:function(){return this.parent}});Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)})();
(function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(b){this.nodeType="Group";Kinetic.Container.call(this,b)},_validateAdd:function(b){b=b.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to groups.")}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container)})();
(function(){Kinetic.Rect=function(b){this.___init(b)};Kinetic.Rect.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Rect"},drawFunc:function(b){var a=this.getCornerRadius(),e=this.getWidth(),d=this.getHeight();b.beginPath();a?(b.moveTo(a,0),b.lineTo(e-a,0),b.arc(e-a,a,a,3*Math.PI/2,0,!1),b.lineTo(e,d-a),b.arc(e-a,d-a,a,0,Math.PI/2,!1),b.lineTo(a,d),b.arc(a,d-a,a,Math.PI/2,Math.PI,!1),b.lineTo(0,a),b.arc(a,a,a,Math.PI,3*Math.PI/2,!1)):b.rect(0,0,e,d);b.closePath();b.fillStrokeShape(this)}};
Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0)})();
(function(){var b=2*Math.PI-1E-4;Kinetic.Circle=function(a){this.___init(a)};Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Circle"},drawFunc:function(a){a.beginPath();a.arc(0,0,this.getRadius(),0,b,!1);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,
a);this.setRadius(a/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0)})();
(function(){var b=2*Math.PI-1E-4;Kinetic.Ellipse=function(a){this.___init(a)};Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ellipse"},drawFunc:function(a){var e=this.getRadius();a.beginPath();a.save();e.x!==e.y&&a.scale(1,e.y/e.x);a.arc(0,0,e.x,0,b,!1);a.restore();a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,
a);this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setRadius({y:a/2})}};Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.Factory.addPointGetterSetter(Kinetic.Ellipse,"radius",0)})();
(function(){Kinetic.Wedge=function(b){this.___init(b)};Kinetic.Wedge.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Wedge"},drawFunc:function(b){b.beginPath();b.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise());b.lineTo(0,0);b.closePath();b.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0);Kinetic.Factory.addRotationGetterSetter(Kinetic.Wedge,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,
"clockwise",!1)})();
(function(){Kinetic.Image=function(b){this.___init(b)};Kinetic.Image.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Image"},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},drawFunc:function(b){var a=this.getWidth(),e=this.getHeight(),d,c;this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1);if(this.filterCanvas)c=this.filterCanvas._canvas,d=[c,0,0,a,e];else if(c=this.getImage())(d=this.getCrop())?
(d.x=d.x||0,d.y=d.y||0,d.width=d.width||c.width-d.x,d.height=d.height||c.height-d.y,d=[c,d.x,d.y,d.width,d.height,0,0,a,e]):d=[c,0,0,a,e];b.beginPath();b.rect(0,0,a,e);b.closePath();b.fillStrokeShape(this);c&&b.drawImage.apply(b,d)},drawHitFunc:function(b){var a=this.getWidth(),e=this.getHeight(),d=this.imageHitRegion;d?(b.drawImage(d,0,0,a,e),b.beginPath(),b.rect(0,0,a,e),b.closePath(),b.strokeShape(this)):(b.beginPath(),b.rect(0,0,a,e),b.closePath(),b.fillStrokeShape(this))},applyFilter:function(){var b=
this.getImage();this.getWidth();this.getHeight();var a=this.getFilter(),e=this.getCrop()||{},d,c;e.x=e.x||0;e.y=e.y||0;e.width=e.width||b.width-e.x;e.height=e.height||b.height-e.y;this.filterCanvas&&this.filterCanvas.getWidth()===e.width&&this.filterCanvas.getHeight()===e.height?(d=this.filterCanvas,d.getContext().clear()):d=this.filterCanvas=new Kinetic.SceneCanvas({width:e.width,height:e.height,pixelRatio:1});d=d.getContext();try{d.drawImage(b,e.x,e.y,e.width,e.height,0,0,e.width,e.height),c=d.getImageData(0,
0,e.width,e.height),a.call(this,c),d.putImageData(c,0,0)}catch(f){this.clearFilter(),Kinetic.Util.warn("Unable to apply filter. "+f.message)}},clearFilter:function(){this.filterCanvas=null;this._applyFilter=!1},createImageHitRegion:function(b){var a=this,e=this.getWidth(),d=this.getHeight(),c=(new Kinetic.SceneCanvas({width:e,height:d})).getContext()._context,f=this.getImage(),l,h,k,g,m;c.drawImage(f,0,0);try{l=c.getImageData(0,0,e,d);h=l.data;m=h.length;k=Kinetic.Util._hexToRgb(this.colorKey);for(g=
0;g<m;g+=4)0<h[g+3]&&(h[g]=k.r,h[g+1]=k.g,h[g+2]=k.b);Kinetic.Util._getImage(l,function(c){a.imageHitRegion=c;b&&b()})}catch(n){Kinetic.Util.warn("Unable to create image hit region. "+n.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var b=this.getImage();return this.attrs.width||(b?b.width:0)},getHeight:function(){var b=this.getImage();return this.attrs.height||(b?b.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addFilterGetterSetter=
function(b,a,e){this.addGetter(b,a,e);this.addFilterSetter(b,a)};Kinetic.Factory.addFilterSetter=function(b,a){var e="set"+Kinetic.Util._capitalize(a);b.prototype[e]=function(b){this._setAttr(a,b);this._applyFilter=!0}};Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addBoxGetterSetter(Kinetic.Image,"crop");Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filter")})();
(function(){Kinetic.Polygon=function(b){this.___init(b)};Kinetic.Polygon.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Polygon"},drawFunc:function(b){var a=this.getPoints(),e=a.length;b.beginPath();b.moveTo(a[0].x,a[0].y);for(var d=1;d<e;d++)b.lineTo(a[d].x,a[d].y);b.closePath();b.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Polygon,Kinetic.Shape);Kinetic.Factory.addPointsGetterSetter(Kinetic.Polygon,"points")})();
(function(){function b(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}var e="fontFamily fontSize fontStyle padding align lineHeight text width height wrap".split(" "),d=e.length,c=document.createElement("canvas").getContext("2d");Kinetic.Text=function(a){this.___init(a)};Kinetic.Text.prototype={___init:function(c){void 0===c.width&&(c.width="auto");void 0===c.height&&(c.height="auto");Kinetic.Shape.call(this,c);this._fillFunc=b;this._strokeFunc=a;this.className=
"Text";for(c=0;c<d;c++)this.on(e[c]+"Change.kinetic",this._setTextData);this._setTextData()},drawFunc:function(a){var b=this.getPadding();this.getFontStyle();this.getFontSize();this.getFontFamily();var c=this.getTextHeight(),d=this.getLineHeight()*c,e=this.textArr,m=e.length,n=this.getWidth();a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();a.translate(b,0);a.translate(0,b+c/2);for(c=0;c<m;c++){var p=e[c],q=p.text,p=p.width;a.save();
"right"===this.getAlign()?a.translate(n-p-2*b,0):"center"===this.getAlign()&&a.translate((n-p-2*b)/2,0);this.partialText=q;a.fillStrokeShape(this);a.restore();a.translate(0,d)}a.restore()},drawHitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath();a.rect(0,0,b,c);a.closePath();a.fillStrokeShape(this)},setText:function(a){a=Kinetic.Util._isString(a)?a:a.toString();this._setAttr("text",a)},getWidth:function(){return"auto"===this.attrs.width?this.getTextWidth()+2*this.getPadding():
this.attrs.width},getHeight:function(){return"auto"===this.attrs.height?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b=this.getFontSize();c.save();c.font=this._getContextFont();a=c.measureText(a);c.restore();return{width:a.width,height:parseInt(b,10)}},_getContextFont:function(){return this.getFontStyle()+" "+this.getFontSize()+
"px "+this.getFontFamily()},_addTextLine:function(a,b,c){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return c.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),d=0,e=this.getLineHeight()*b,g=this.attrs.width,m=this.attrs.height,n="auto"!==g,p="auto"!==m,q=this.getPadding(),g=g-2*q,m=m-2*q,q=0,r=this.getWrap(),s="none"!==r,r="char"!==r&&s;this.textArr=[];c.save();c.font=this.getFontStyle()+" "+b+"px "+this.getFontFamily();
for(var u=0,w=a.length;u<w;++u){var v=a[u],x=this._getTextWidth(v);if(n&&x>g)for(;0<v.length;){for(var x=0,A=v.length,y="",D=0;x<A;){var E=x+A>>>1,F=v.slice(0,E+1),G=this._getTextWidth(F);G<=g?(x=E+1,y=F,D=G):A=E}if(y){r&&(A=Math.max(y.lastIndexOf(" "),y.lastIndexOf("-"))+1,0<A&&(x=A,y=y.slice(0,x),D=this._getTextWidth(y)));this._addTextLine(y,D);q+=e;if(!s||p&&q+e>m)break;v=v.slice(x);if(0<v.length&&(x=this._getTextWidth(v),x<=g)){this._addTextLine(v,x);q+=e;break}}else break}else this._addTextLine(v,
x),q+=e,d=Math.max(d,x);if(p&&q+e>m)break}c.restore();this.textHeight=b;this.textWidth=d}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Calibri");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,"align","left");Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",
1);Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap","word");Kinetic.Factory.addGetter(Kinetic.Text,"text","");Kinetic.Factory.addSetter(Kinetic.Text,"width");Kinetic.Factory.addSetter(Kinetic.Text,"height")})();
(function(){Kinetic.Line=function(b){this.___init(b)};Kinetic.Line.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Line"},drawFunc:function(b){var a=this.getPoints(),e=a.length,d,c;b.beginPath();b.moveTo(a[0].x,a[0].y);for(d=1;d<e;d++)c=a[d],b.lineTo(c.x,c.y);b.strokeShape(this)}};Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape);Kinetic.Factory.addPointsGetterSetter(Kinetic.Line,"points")})();
(function(){Kinetic.Spline=function(b){this.___init(b)};Kinetic.Spline.prototype={___init:function(b){var a=this;Kinetic.Shape.call(this,b);this.className="Spline";this.on("pointsChange.kinetic tensionChange.kinetic",function(){a._setAllPoints()});this._setAllPoints()},drawFunc:function(b){var a=this.getPoints(),e=a.length,d=this.getTension(),c,f;b.beginPath();b.moveTo(a[0].x,a[0].y);if(0!==d&&2<e){c=this.allPoints;f=c.length;d=2;for(b.quadraticCurveTo(c[0].x,c[0].y,c[1].x,c[1].y);d<f-1;)b.bezierCurveTo(c[d].x,
c[d++].y,c[d].x,c[d++].y,c[d].x,c[d++].y);b.quadraticCurveTo(c[f-1].x,c[f-1].y,a[e-1].x,a[e-1].y)}else for(d=1;d<e;d++)c=a[d],b.lineTo(c.x,c.y);b.strokeShape(this)},_setAllPoints:function(){this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}};Kinetic.Util.extend(Kinetic.Spline,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Spline,"tension",1);Kinetic.Factory.addPointsGetterSetter(Kinetic.Spline,"points")})();
(function(){Kinetic.Blob=function(b){this.___init(b)};Kinetic.Blob.prototype={___init:function(b){var a=this;Kinetic.Shape.call(this,b);this.className="Blob";this.on("pointsChange.kinetic tensionChange.kinetic",function(){a._setAllPoints()});this._setAllPoints()},drawFunc:function(b){var a=this.getPoints(),e=a.length,d=this.getTension(),c;b.beginPath();b.moveTo(a[0].x,a[0].y);if(0!==d&&2<e)for(a=this.allPoints,e=a.length,d=0;d<e-1;)b.bezierCurveTo(a[d].x,a[d++].y,a[d].x,a[d++].y,a[d].x,a[d++].y);
else for(d=1;d<e;d++)c=a[d],b.lineTo(c.x,c.y);b.closePath();b.fillStrokeShape(this)},_setAllPoints:function(){var b=this.getPoints(),a=b.length,e=this.getTension(),d=Kinetic.Util,c=d._getControlPoints(b[a-1],b[0],b[1],e),e=d._getControlPoints(b[a-2],b[a-1],b[0],e);this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension());this.allPoints.unshift(c[1]);this.allPoints.push(e[0]);this.allPoints.push(b[a-1]);this.allPoints.push(e[1]);this.allPoints.push(c[0]);this.allPoints.push(b[0])}};
Kinetic.Util.extend(Kinetic.Blob,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Blob,"tension",1);Kinetic.Factory.addPointsGetterSetter(Kinetic.Blob,"points")})();
(function(){Kinetic.Sprite=function(b){this.___init(b)};Kinetic.Sprite.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Sprite";this.anim=new Kinetic.Animation;var a=this;this.on("animationChange.kinetic",function(){a.setIndex(0)})},drawFunc:function(b){var a=this.getAnimation(),e=this.getIndex(),a=this.getAnimations()[a][e];(e=this.getImage())&&b.drawImage(e,a.x,a.y,a.width,a.height,0,0,a.width,a.height)},drawHitFunc:function(b){var a=this.getAnimation(),e=this.getIndex(),
a=this.getAnimations()[a][e];b.beginPath();b.rect(0,0,a.width,a.height);b.closePath();b.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var b=this,a=this.getLayer();this.anim.setLayers(a);this.interval=setInterval(function(){var a=b.getIndex();b._updateIndex();b.afterFrameFunc&&a===b.afterFrameIndex&&(b.afterFrameFunc(),delete b.afterFrameFunc,delete b.afterFrameIndex)},1E3/this.getFrameRate());this.anim.start()},
stop:function(){this.anim.stop();clearInterval(this.interval)},afterFrame:function(b,a){this.afterFrameIndex=b;this.afterFrameFunc=a},_updateIndex:function(){var b=this.getIndex(),a=this.getAnimation(),a=this.getAnimations()[a].length;b<a-1?this.setIndex(b+1):this.setIndex(0)}};Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image");
Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"index",0);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17)})();
(function(){Kinetic.Path=function(b){this.___init(b)};Kinetic.Path.prototype={___init:function(b){this.dataArray=[];var a=this;Kinetic.Shape.call(this,b);this.className="Path";this.dataArray=Kinetic.Path.parsePathData(this.getData());this.on("dataChange.kinetic",function(){a.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(b){var a=this.dataArray,e=!1;b.beginPath();for(var d=0;d<a.length;d++){var c=a[d].points;switch(a[d].command){case "L":b.lineTo(c[0],c[1]);break;case "M":b.moveTo(c[0],
c[1]);break;case "C":b.bezierCurveTo(c[0],c[1],c[2],c[3],c[4],c[5]);break;case "Q":b.quadraticCurveTo(c[0],c[1],c[2],c[3]);break;case "A":var f=c[0],l=c[1],h=c[2],k=c[3],g=c[4],m=c[5],n=c[6],c=c[7],p=h>k?h:k,q=h>k?1:h/k,h=h>k?k/h:1;b.translate(f,l);b.rotate(n);b.scale(q,h);b.arc(0,0,p,g,g+m,1-c);b.scale(1/q,1/h);b.rotate(-n);b.translate(-f,-l);break;case "z":b.closePath(),e=!0}}e?b.fillStrokeShape(this):b.strokeShape(this)}};Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape);Kinetic.Path.getLineLength=
function(b,a,e,d){return Math.sqrt((e-b)*(e-b)+(d-a)*(d-a))};Kinetic.Path.getPointOnLine=function(b,a,e,d,c,f,l){void 0===f&&(f=a);void 0===l&&(l=e);var h=(c-e)/(d-a+1E-8),k=Math.sqrt(b*b/(1+h*h));d<a&&(k*=-1);var g=h*k;if(d===a)a={x:f,y:l+g};else if((l-e)/(f-a+1E-8)===h)a={x:f+k,y:l+g};else{g=this.getLineLength(a,e,d,c);if(1E-8>g)return;k=((f-a)*(d-a)+(l-e)*(c-e))/(g*g);g=a+k*(d-a);e+=k*(c-e);f=this.getLineLength(f,l,g,e);b=Math.sqrt(b*b-f*f);k=Math.sqrt(b*b/(1+h*h));d<a&&(k*=-1);a={x:g+k,y:e+h*
k}}return a};Kinetic.Path.getPointOnCubicBezier=function(b,a,e,d,c,f,l,h,k){return{x:h*b*b*b+3*f*b*b*(1-b)+3*d*b*(1-b)*(1-b)+a*(1-b)*(1-b)*(1-b),y:k*b*b*b+3*l*b*b*(1-b)+3*c*b*(1-b)*(1-b)+e*(1-b)*(1-b)*(1-b)}};Kinetic.Path.getPointOnQuadraticBezier=function(b,a,e,d,c,f,l){return{x:f*b*b+2*d*b*(1-b)+a*(1-b)*(1-b),y:l*b*b+2*c*b*(1-b)+e*(1-b)*(1-b)}};Kinetic.Path.getPointOnEllipticalArc=function(b,a,e,d,c,f){var l=Math.cos(f);f=Math.sin(f);e*=Math.cos(c);d*=Math.sin(c);return{x:b+(e*l-d*f),y:a+(e*f+d*
l)}};Kinetic.Path.parsePathData=function(b){if(!b)return[];var a,e="mMlLvVhHzZcCqQtTsSaA".split("");a=b.replace(RegExp(" ","g"),",");for(b=0;b<e.length;b++)a=a.replace(RegExp(e[b],"g"),"|"+e[b]);e=a.split("|");a=[];var d=0,c=0;for(b=1;b<e.length;b++){var f=e[b],l=f.charAt(0),f=f.slice(1),f=f.replace(RegExp(",-","g"),"-"),f=f.replace(RegExp("-","g"),",-"),f=f.replace(RegExp("e,-","g"),"e-"),f=f.split(",");0<f.length&&""===f[0]&&f.shift();for(var h=0;h<f.length;h++)f[h]=parseFloat(f[h]);for(;0<f.length&&
!isNaN(f[0]);){var k=null,g=[],h=d,m=c,n,p,q,r,s,u;switch(l){case "l":d+=f.shift();c+=f.shift();k="L";g.push(d,c);break;case "L":d=f.shift();c=f.shift();g.push(d,c);break;case "m":d+=f.shift();c+=f.shift();k="M";g.push(d,c);l="l";break;case "M":d=f.shift();c=f.shift();k="M";g.push(d,c);l="L";break;case "h":d+=f.shift();k="L";g.push(d,c);break;case "H":d=f.shift();k="L";g.push(d,c);break;case "v":c+=f.shift();k="L";g.push(d,c);break;case "V":c=f.shift();k="L";g.push(d,c);break;case "C":g.push(f.shift(),
f.shift(),f.shift(),f.shift());d=f.shift();c=f.shift();g.push(d,c);break;case "c":g.push(d+f.shift(),c+f.shift(),d+f.shift(),c+f.shift());d+=f.shift();c+=f.shift();k="C";g.push(d,c);break;case "S":n=d;p=c;k=a[a.length-1];"C"===k.command&&(n=d+(d-k.points[2]),p=c+(c-k.points[3]));g.push(n,p,f.shift(),f.shift());d=f.shift();c=f.shift();k="C";g.push(d,c);break;case "s":n=d;p=c;k=a[a.length-1];"C"===k.command&&(n=d+(d-k.points[2]),p=c+(c-k.points[3]));g.push(n,p,d+f.shift(),c+f.shift());d+=f.shift();
c+=f.shift();k="C";g.push(d,c);break;case "Q":g.push(f.shift(),f.shift());d=f.shift();c=f.shift();g.push(d,c);break;case "q":g.push(d+f.shift(),c+f.shift());d+=f.shift();c+=f.shift();k="Q";g.push(d,c);break;case "T":n=d;p=c;k=a[a.length-1];"Q"===k.command&&(n=d+(d-k.points[0]),p=c+(c-k.points[1]));d=f.shift();c=f.shift();k="Q";g.push(n,p,d,c);break;case "t":n=d;p=c;k=a[a.length-1];"Q"===k.command&&(n=d+(d-k.points[0]),p=c+(c-k.points[1]));d+=f.shift();c+=f.shift();k="Q";g.push(n,p,d,c);break;case "A":g=
f.shift();n=f.shift();p=f.shift();q=f.shift();r=f.shift();s=d;u=c;d=f.shift();c=f.shift();k="A";g=this.convertEndpointToCenterParameterization(s,u,d,c,q,r,g,n,p);break;case "a":g=f.shift(),n=f.shift(),p=f.shift(),q=f.shift(),r=f.shift(),s=d,u=c,d+=f.shift(),c+=f.shift(),k="A",g=this.convertEndpointToCenterParameterization(s,u,d,c,q,r,g,n,p)}a.push({command:k||l,points:g,start:{x:h,y:m},pathLength:this.calcLength(h,m,k||l,g)})}"z"!==l&&"Z"!==l||a.push({command:"z",points:[],start:void 0,pathLength:0})}return a};
Kinetic.Path.calcLength=function(b,a,e,d){var c,f,l=Kinetic.Path;switch(e){case "L":return l.getLineLength(b,a,d[0],d[1]);case "C":e=0;c=l.getPointOnCubicBezier(0,b,a,d[0],d[1],d[2],d[3],d[4],d[5]);for(t=0.01;1>=t;t+=0.01)f=l.getPointOnCubicBezier(t,b,a,d[0],d[1],d[2],d[3],d[4],d[5]),e+=l.getLineLength(c.x,c.y,f.x,f.y),c=f;return e;case "Q":e=0;c=l.getPointOnQuadraticBezier(0,b,a,d[0],d[1],d[2],d[3]);for(t=0.01;1>=t;t+=0.01)f=l.getPointOnQuadraticBezier(t,b,a,d[0],d[1],d[2],d[3]),e+=l.getLineLength(c.x,
c.y,f.x,f.y),c=f;return e;case "A":e=0;f=d[4];var h=d[5];b=d[4]+h;a=Math.PI/180;Math.abs(f-b)<a&&(a=Math.abs(f-b));c=l.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],f,0);if(0>h)for(t=f-a;t>b;t-=a)f=l.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=l.getLineLength(c.x,c.y,f.x,f.y),c=f;else for(t=f+a;t<b;t+=a)f=l.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=l.getLineLength(c.x,c.y,f.x,f.y),c=f;f=l.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],b,0);return e+=l.getLineLength(c.x,c.y,f.x,f.y)}return 0};
Kinetic.Path.convertEndpointToCenterParameterization=function(b,a,e,d,c,f,l,h,k){k*=Math.PI/180;var g=Math.cos(k)*(b-e)/2+Math.sin(k)*(a-d)/2,m=-1*Math.sin(k)*(b-e)/2+Math.cos(k)*(a-d)/2,n=g*g/(l*l)+m*m/(h*h);1<n&&(l*=Math.sqrt(n),h*=Math.sqrt(n));n=Math.sqrt((l*l*h*h-l*l*m*m-h*h*g*g)/(l*l*m*m+h*h*g*g));c==f&&(n*=-1);isNaN(n)&&(n=0);c=n*l*m/h;n=n*-h*g/l;b=(b+e)/2+Math.cos(k)*c-Math.sin(k)*n;a=(a+d)/2+Math.sin(k)*c+Math.cos(k)*n;var p=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(a[0]*a[0]+
a[1]*a[1])*Math.sqrt(b[0]*b[0]+b[1]*b[1]))},q=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(p(a,b))};d=q([1,0],[(g-c)/l,(m-n)/h]);e=[(g-c)/l,(m-n)/h];g=[(-1*g-c)/l,(-1*m-n)/h];m=q(e,g);-1>=p(e,g)&&(m=Math.PI);1<=p(e,g)&&(m=0);0===f&&0<m&&(m-=2*Math.PI);1==f&&0>m&&(m+=2*Math.PI);return[b,a,l,h,d,m,k,f]};Kinetic.Factory.addGetterSetter(Kinetic.Path,"data")})();
(function(){function b(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}Kinetic.TextPath=function(a){this.___init(a)};Kinetic.TextPath.prototype={___init:function(e){var d=this;this.dummyCanvas=document.createElement("canvas");this.dataArray=[];Kinetic.Shape.call(this,e);this._fillFunc=b;this._strokeFunc=a;this.className="TextPath";this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange.kinetic",function(){d.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});
this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",d._setTextData);d._setTextData()},drawFunc:function(a){a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var f=b[c].p0;parseFloat(this.attrs.fontSize);a.translate(f.x,f.y);a.rotate(b[c].rotation);this.partialText=b[c].text;a.fillStrokeShape(this);a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},
getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas.getContext("2d");b.save();b.font=this._getContextFont();a=b.measureText(a);b.restore();return{width:a.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this._getTextSize(this.attrs.text);this.textWidth=a.width;this.textHeight=a.height;this.glyphInfo=[];for(var a=this.attrs.text.split(""),b,c,f,l=-1,h=0,k=0;k<a.length;k++){var g=
this._getTextSize(a[k]).width,m=0,n=0;for(c=void 0;0.01<Math.abs(g-m)/g&&25>n;){n++;for(var p=m;void 0===f;){a:{h=0;f=this.dataArray;for(var q=l+1;q<f.length;q++)if(0<f[q].pathLength){l=q;f=f[q];break a}else"M"==f[q].command&&(b={x:f[q].points[0],y:f[q].points[1]});f={}}f&&p+f.pathLength<g&&(p+=f.pathLength,f=void 0)}if(f==={}||void 0===b)break;p=!1;switch(f.command){case "L":Kinetic.Path.getLineLength(b.x,b.y,f.points[0],f.points[1])>g?c=Kinetic.Path.getPointOnLine(g,b.x,b.y,f.points[0],f.points[1],
b.x,b.y):f=void 0;break;case "A":c=f.points[4];var q=f.points[5],r=f.points[4]+q,h=0===h?c+1E-8:g>m?h+Math.PI/180*q/Math.abs(q):h-Math.PI/360*q/Math.abs(q);if(0>q&&h<r||0<=q&&h>r)h=r,p=!0;c=Kinetic.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],h,f.points[6]);break;case "C":h=0===h?g>f.pathLength?1E-8:g/f.pathLength:g>m?h+(g-m)/f.pathLength:h-(m-g)/f.pathLength;1<h&&(h=1,p=!0);c=Kinetic.Path.getPointOnCubicBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],
f.points[3],f.points[4],f.points[5]);break;case "Q":h=0===h?g/f.pathLength:g>m?h+(g-m)/f.pathLength:h-(m-g)/f.pathLength,1<h&&(h=1,p=!0),c=Kinetic.Path.getPointOnQuadraticBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}void 0!==c&&(m=Kinetic.Path.getLineLength(b.x,b.y,c.x,c.y));p&&(f=void 0)}if(void 0===b||void 0===c)break;g=Kinetic.Path.getLineLength(b.x,b.y,c.x,c.y);g=Kinetic.Path.getPointOnLine(0+g/2,b.x,b.y,c.x,c.y);m=Math.atan2(c.y-b.y,c.x-b.x);this.glyphInfo.push({transposeX:g.x,
transposeY:g.y,text:a[k],rotation:m,p0:b,p1:c});b=c}}};Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont;Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Calibri");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle","normal");Kinetic.Factory.addGetter(Kinetic.TextPath,"text","")})();
(function(){Kinetic.RegularPolygon=function(b){this.___init(b)};Kinetic.RegularPolygon.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="RegularPolygon"},drawFunc:function(b){var a=this.attrs.sides,e=this.attrs.radius,d,c,f;b.beginPath();b.moveTo(0,0-e);for(d=1;d<a;d++)c=e*Math.sin(2*d*Math.PI/a),f=-1*e*Math.cos(2*d*Math.PI/a),b.lineTo(c,f);b.closePath();b.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,
"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0)})();
(function(){Kinetic.Star=function(b){this.___init(b)};Kinetic.Star.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Star"},drawFunc:function(b){var a=b._context,e=this.attrs.innerRadius,d=this.attrs.outerRadius,c=this.attrs.numPoints;a.beginPath();a.moveTo(0,0-this.attrs.outerRadius);for(var f=1;f<2*c;f++){var l=0===f%2?d:e,h=l*Math.sin(f*Math.PI/c),l=-1*l*Math.cos(f*Math.PI/c);a.lineTo(h,l)}a.closePath();b.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape);
Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0)})();
(function(){var b="fontFamily fontSize fontStyle padding lineHeight text".split(" "),a=b.length;Kinetic.Label=function(a){this.____init(a)};Kinetic.Label.prototype={____init:function(a){var b=this;this.className="Label";Kinetic.Group.call(this,a);this.on("add.kinetic",function(a){b._addListeners(a.child);b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(e){var d=this,c,f=function(){d._sync()};for(c=0;c<a;c++)e.on(b[c]+
"Change.kinetic",f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a=this.getText(),b=this.getTag(),c,f,l,h,k,g;if(a&&b){c=a.getWidth();f=a.getHeight();l=b.getPointerDirection();h=b.getPointerWidth();pointerHeight=b.getPointerHeight();g=k=0;switch(l){case "up":k=c/2;g=-1*pointerHeight;break;case "right":k=c+h;g=f/2;break;case "down":k=c/2;g=f+pointerHeight;break;case "left":k=-1*h,g=f/2}b.setAttrs({x:-1*k,y:-1*g,
width:c,height:f});a.setAttrs({x:-1*k,y:-1*g})}}};Kinetic.Util.extend(Kinetic.Label,Kinetic.Group);Kinetic.Tag=function(a){this.___init(a)};Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Tag"},drawFunc:function(a){var b=this.getWidth(),c=this.getHeight(),f=this.getPointerDirection(),l=this.getPointerWidth(),h=this.getPointerHeight();this.getCornerRadius();a.beginPath();a.moveTo(0,0);"up"===f&&(a.lineTo((b-l)/2,0),a.lineTo(b/2,-1*h),a.lineTo((b+l)/2,0));a.lineTo(b,
0);"right"===f&&(a.lineTo(b,(c-h)/2),a.lineTo(b+l,c/2),a.lineTo(b,(c+h)/2));a.lineTo(b,c);"down"===f&&(a.lineTo((b+l)/2,c),a.lineTo(b/2,c+h),a.lineTo((b-l)/2,c));a.lineTo(0,c);"left"===f&&(a.lineTo(0,(c+h)/2),a.lineTo(-1*l,c/2),a.lineTo(0,(c-h)/2));a.closePath();a.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection","none");Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,
"pointerHeight",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0)})();(function(){Kinetic.Filters.Grayscale=function(b){b=b.data;for(var a=0;a<b.length;a+=4){var e=0.34*b[a]+0.5*b[a+1]+0.16*b[a+2];b[a]=e;b[a+1]=e;b[a+2]=e}}})();(function(){Kinetic.Filters.Brighten=function(b){var a=this.getFilterBrightness();b=b.data;for(var e=0;e<b.length;e+=4)b[e]+=a,b[e+1]+=a,b[e+2]+=a};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterBrightness",0)})();
(function(){Kinetic.Filters.Invert=function(b){b=b.data;for(var a=0;a<b.length;a+=4)b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2]}})();
(function(){function b(){this.a=this.b=this.g=this.r=0;this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,
367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,
310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(d){var c=this.getFilterRadius()|0;if(0<c){var f=d.data,l=d.width;d=d.height;var h,k,g,m,n,p,q,r,s,u,w,v,x,A,y,D,E,
F,G,I,J,B,C;h=c+c+1;var O=l-1,P=d-1,H=c+1,K=H*(H+1)/2,N=new b,Q=null,z=N;C=g=null;var L=a[c],M=e[c];for(g=1;g<h;g++)z=z.next=new b,g==H&&(Q=z);z.next=N;for(k=p=n=0;k<d;k++){y=D=E=F=q=r=s=u=0;w=H*(G=f[n]);v=H*(I=f[n+1]);x=H*(J=f[n+2]);A=H*(B=f[n+3]);q+=K*G;r+=K*I;s+=K*J;u+=K*B;z=N;for(g=0;g<H;g++)z.r=G,z.g=I,z.b=J,z.a=B,z=z.next;for(g=1;g<H;g++)m=n+((O<g?O:g)<<2),q+=(z.r=G=f[m])*(C=H-g),r+=(z.g=I=f[m+1])*C,s+=(z.b=J=f[m+2])*C,u+=(z.a=B=f[m+3])*C,y+=G,D+=I,E+=J,F+=B,z=z.next;g=N;C=Q;for(h=0;h<l;h++)f[n+
3]=B=u*L>>M,0!==B?(B=255/B,f[n]=(q*L>>M)*B,f[n+1]=(r*L>>M)*B,f[n+2]=(s*L>>M)*B):f[n]=f[n+1]=f[n+2]=0,q-=w,r-=v,s-=x,u-=A,w-=g.r,v-=g.g,x-=g.b,A-=g.a,m=p+((m=h+c+1)<O?m:O)<<2,y+=g.r=f[m],D+=g.g=f[m+1],E+=g.b=f[m+2],F+=g.a=f[m+3],q+=y,r+=D,s+=E,u+=F,g=g.next,w+=G=C.r,v+=I=C.g,x+=J=C.b,A+=B=C.a,y-=G,D-=I,E-=J,F-=B,C=C.next,n+=4;p+=l}for(h=0;h<l;h++){D=E=F=y=r=s=u=q=0;n=h<<2;w=H*(G=f[n]);v=H*(I=f[n+1]);x=H*(J=f[n+2]);A=H*(B=f[n+3]);q+=K*G;r+=K*I;s+=K*J;u+=K*B;z=N;for(g=0;g<H;g++)z.r=G,z.g=I,z.b=J,z.a=
B,z=z.next;m=l;for(g=1;g<=c;g++)n=m+h<<2,q+=(z.r=G=f[n])*(C=H-g),r+=(z.g=I=f[n+1])*C,s+=(z.b=J=f[n+2])*C,u+=(z.a=B=f[n+3])*C,y+=G,D+=I,E+=J,F+=B,z=z.next,g<P&&(m+=l);n=h;g=N;C=Q;for(k=0;k<d;k++)m=n<<2,f[m+3]=B=u*L>>M,0<B?(B=255/B,f[m]=(q*L>>M)*B,f[m+1]=(r*L>>M)*B,f[m+2]=(s*L>>M)*B):f[m]=f[m+1]=f[m+2]=0,q-=w,r-=v,s-=x,u-=A,w-=g.r,v-=g.g,x-=g.b,A-=g.a,m=h+((m=k+H)<P?m:P)*l<<2,q+=y+=g.r=f[m],r+=D+=g.g=f[m+1],s+=E+=g.b=f[m+2],u+=F+=g.a=f[m+3],g=g.next,w+=G=C.r,v+=I=C.g,x+=J=C.b,A+=B=C.a,y-=G,D-=I,E-=
J,F-=B,C=C.next,n+=l}}};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterRadius",0)})();
(function(){function b(a,b,c){b=4*(c*a.width+b);c=[];c.push(a.data[b++],a.data[b++],a.data[b++],a.data[b++]);return c}function a(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}Kinetic.Filters.Mask=function(e){var d;d=this.getFilterThreshold();var c=b(e,0,0),f=b(e,e.width-1,0),l=b(e,0,e.height-1),h=b(e,e.width-1,e.height-1);d=d||10;if(a(c,f)<d&&a(f,h)<d&&a(h,l)<d&&a(l,c)<d){f=[f,c,h,l];c=[0,0,0];for(l=0;l<f.length;l++)c[0]+=f[l][0],c[1]+=f[l][1],c[2]+=f[l][2];
c[0]/=f.length;c[1]/=f.length;c[2]/=f.length;f=[];for(l=0;l<e.width*e.height;l++)h=a(c,[e.data[4*l],e.data[4*l+1],e.data[4*l+2]]),f[l]=h<d?0:255;d=f}else d=void 0;if(d){for(var c=e.width,f=e.height,l=[1,1,1,1,0,1,1,1,1],h=Math.round(Math.sqrt(l.length)),k=Math.floor(h/2),g=[],m=0;m<f;m++)for(var n=0;n<c;n++){for(var p=m*c+n,q=0,r=0;r<h;r++)for(var s=0;s<h;s++){var u=m+r-k,w=n+s-k;0<=u&&u<f&&0<=w&&w<c&&(q+=d[u*c+w]*l[r*h+s])}g[p]=2040===q?255:0}d=g;c=e.width;f=e.height;l=[1,1,1,1,1,1,1,1,1];h=Math.round(Math.sqrt(l.length));
k=Math.floor(h/2);g=[];for(m=0;m<f;m++)for(n=0;n<c;n++){p=m*c+n;for(r=q=0;r<h;r++)for(s=0;s<h;s++)u=m+r-k,w=n+s-k,0<=u&&u<f&&0<=w&&w<c&&(q+=d[u*c+w]*l[r*h+s]);g[p]=1020<=q?255:0}d=g;c=e.width;f=e.height;l=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];h=Math.round(Math.sqrt(l.length));k=Math.floor(h/2);g=[];for(m=0;m<f;m++)for(n=0;n<c;n++){p=m*c+n;for(r=q=0;r<h;r++)for(s=0;s<h;s++)u=m+r-k,w=n+s-k,0<=u&&u<f&&0<=w&&w<c&&(q+=d[u*c+w]*l[r*h+s]);g[p]=q}d=g;for(c=0;c<e.width*e.height;c++)e.data[4*c+3]=d[c]}return e};
Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterThreshold",0)})();
(function(){var b=function(a,b){for(var d=a.data,c,f=0;f<d.length;f+=4){var l=d[f+0],h=d[f+1],k=d[f+2],g=b,l=l/255,h=h/255,k=k/255,m=Math.max(l,h,k);c=Math.min(l,h,k);c=m-c;var n=c/2;Math.abs(2*n-1);var p=0;m==l?p=(h-k)/c%6:m==h?p=(k-l)/c+2:m==k&&(p=(l-h)/c+4);p*=60;p%=360;p+=g;p%=360;p/=60;k=h=l=0;g=c*(1-Math.abs(p%2-1));n-=c/2;0<=p&&1>p?(l=c,h=g):1<=p&&2>p?(h=c,l=g):2<=p&&3>p?(h=c,k=g):3<=p&&4>p?(k=c,h=g):4<=p&&5>p?(k=c,l=g):5<=p&&6>p&&(l=c,k=g);l+=n;h+=n;k+=n;l*=255;h*=255;k*=255;c=[l,h,k];d[f+
0]=c[0];d[f+1]=c[1];d[f+2]=c[2]}};Kinetic.Filters.ShiftHue=function(a){b(a,this.getFilterHueShiftDeg()%360)};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterHueShiftDeg",0);Kinetic.Filters.Colorize=function(a){var e=a.data,d=this.getFilterColorizeColor(),c=d[0],f=d[1],d=d[2],c=c/255,f=f/255,d=d/255,l=Math.max(c,f,d),h=Math.min(c,f,d),k=l-h;Math.abs(2*(k/2)-1);h=0;l==c?h=(f-d)/k%6:l==f?h=(d-c)/k+2:l==d&&(h=(c-f)/k+4);for(c=0;c<e.length;c+=4)e[c+1]=0,e[c+2]=0;b(a,(60*h+360)%360)};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,
"filterColorizeColor",[255,0,0])})();
(function(){var b=function(a,b){var e=a.data,l=a.width,h=a.height,k=[];k.length=4*l*h;var g=b.length,m=b[0].length,n=Math.floor(b.length/2),p=Math.floor(b[0].length/2),q,r,s,u,w,v,x,A,y;for(w=0;w<h;w+=1)for(u=0;u<l;u+=1){for(A=s=r=q=0;A<g;A+=1)for(y=0;y<m;y+=1)v=(u+A-n)%l,v=0<v?v:-v,x=(w+A-p)%h,x=0<x?x:-x,v=4*(x*l+v),q+=b[y][A]*e[v+0],r+=b[y][A]*e[v+1],s+=b[y][A]*e[v+2];v=4*(w*l+u);k[v+0]=q;k[v+1]=r;k[v+2]=s}l=4*l*h;for(v=0;v<l;v+=4)e[v+0]=k[v+0],e[v+1]=k[v+1],e[v+2]=k[v+2]},a=function(a,b,e){a-=
b;return Math.pow(Math.E,-a*a/(2*e*e))},e=function(b,c,e){0===b%2&&(b+=1);var l=[],h,k,g;for(h=0;h<b;h+=1){g=[];for(k=0;k<b;k+=1)g.push(c*a(h,b/2,e)*a(k,b/2,e));l.push(g)}return l};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterAmount",50);Kinetic.Filters.UnsharpMask=function(a){var c=this.getFilterAmount()/100,f=e(5,-c,1),l=Math.floor(2.5);f[l][l]+=1+c;b(a,f)};Kinetic.Filters.SoftBlur=function(a){var c=this.getFilterAmount()/100,f=e(5,c,1),l=Math.floor(2.5);f[l][l]+=1-c;b(a,f)};Kinetic.Filters.Edge=
function(a){var c=this.getFilterAmount()/100;0!==c&&b(a,[[0,-1*c,0],[-1*c,1-c+4*c,-1*c],[0,-1*c,0]])};Kinetic.Filters.Emboss=function(a){var c=this.getFilterAmount()/100;0!==c&&b(a,[[-1*c,-0.5*c,0],[-0.5*c,1+0.5*c,0.5*c],[0,0.5*c,1*c]])}})();